<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Module 4: Writing and Ingesting Data - InfluxDB Course</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.min.css">
  <!-- Prism.js for code highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">

  <style>
    :root {
      --primary-color: #FF6B6B;
      --secondary-color: #4ECDC4;
      --accent-color: #45B7D1;
      --success-color: #10B981;
      --warning-color: #F59E0B;
      --danger-color: #EF4444;
      --dark-bg: #1F2937;
      --light-bg: #F9FAFB;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
    }

    .hero-section {
      background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 50%, #45B7D1 100%);
      color: white;
      padding: 80px 0;
      margin-bottom: 50px;
      position: relative;
      overflow: hidden;
    }

    .hero-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"><path d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z" opacity=".25" fill="%23ffffff"/></svg>') no-repeat bottom;
      background-size: cover;
      opacity: 0.1;
    }

    .hero-section h1 {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 20px;
    }

    .module-nav {
      background-color: var(--dark-bg);
      padding: 15px 0;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .module-nav .nav-link {
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      transition: background-color 0.3s;
      font-size: 0.9rem;
    }

    .module-nav .nav-link:hover,
    .module-nav .nav-link.active {
      background-color: var(--primary-color);
    }

    .section-title {
      color: var(--primary-color);
      font-weight: 700;
      margin-top: 50px;
      margin-bottom: 30px;
      padding-bottom: 10px;
      border-bottom: 3px solid var(--secondary-color);
    }

    .card {
      border: none;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      margin-bottom: 30px;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
    }

    .card-header {
      font-weight: 600;
      padding: 15px 20px;
    }

    .interactive-tool {
      background: linear-gradient(135deg, #FFE5E5 0%, #E5F9F9 100%);
      border-radius: 15px;
      padding: 40px;
      margin: 40px 0;
      border: 2px solid var(--primary-color);
    }

    .code-block {
      background-color: #2d2d2d;
      border-radius: 8px;
      margin: 20px 0;
      overflow: hidden;
    }

    .code-header {
      background-color: #1a1a1a;
      padding: 10px 20px;
      color: #888;
      font-size: 0.9rem;
      border-bottom: 1px solid #444;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .copy-btn {
      background: transparent;
      border: 1px solid #666;
      color: #888;
      padding: 3px 10px;
      border-radius: 4px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .copy-btn:hover {
      background: #444;
      color: white;
      border-color: #888;
    }

    .method-card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      height: 100%;
      border-left: 5px solid;
      transition: all 0.3s;
    }

    .method-card:hover {
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .method-icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }

    .output-console {
      background-color: #1e1e1e;
      color: #00ff00;
      padding: 20px;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      min-height: 200px;
      margin-top: 15px;
      font-size: 0.9rem;
      overflow-y: auto;
      max-height: 400px;
      border: 2px solid #333;
    }

    .performance-comparison {
      display: flex;
      gap: 20px;
      margin: 30px 0;
    }

    .perf-box {
      flex: 1;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      color: white;
    }

    .perf-bad {
      background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
    }

    .perf-good {
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
    }

    .perf-value {
      font-size: 3rem;
      font-weight: 700;
      margin: 15px 0;
    }

    .btn-demo {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-demo:hover {
      background: var(--secondary-color);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
    }

    .best-practice-card {
      background: linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%);
      border-left: 5px solid var(--success-color);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }

    .warning-card {
      background: linear-gradient(135deg, #FFFBEB 0%, #FEF3C7 100%);
      border-left: 5px solid var(--warning-color);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }

    .danger-card {
      background: linear-gradient(135deg, #FEF2F2 0%, #FEE2E2 100%);
      border-left: 5px solid var(--danger-color);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }

    .comparison-table {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .telegraf-visual {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 40px;
      border-radius: 15px;
      color: white;
      margin: 30px 0;
    }

    .flow-diagram {
      display: flex;
      justify-content: space-around;
      align-items: center;
      flex-wrap: wrap;
      margin: 30px 0;
    }

    .flow-step {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      min-width: 150px;
      margin: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s;
    }

    .flow-step:hover {
      transform: scale(1.05);
    }

    .flow-arrow {
      font-size: 2rem;
      color: var(--primary-color);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
    }

    .footer {
      background-color: var(--dark-bg);
      color: white;
      padding: 40px 0;
      margin-top: 80px;
    }

    .timeline {
      position: relative;
      padding: 20px 0;
    }

    .timeline-item {
      padding: 20px;
      border-left: 3px solid var(--primary-color);
      margin-left: 20px;
      position: relative;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -8px;
      top: 25px;
      width: 13px;
      height: 13px;
      border-radius: 50%;
      background: var(--primary-color);
    }

    .precision-badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.85rem;
      font-weight: 600;
      margin: 3px;
    }

    .live-demo-panel {
      background: #f8f9fa;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }

    .metrics-display {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .metric-box {
      background: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      border: 2px solid #e5e7eb;
    }

    .metric-label {
      font-size: 0.85rem;
      color: #6b7280;
      margin-bottom: 5px;
    }

    .metric-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-color);
    }
  </style>
</head>

<body>
  <!-- Hero Section -->
  <div class="hero-section">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-8">
          <h1><i class="bi bi-arrow-down-circle-fill"></i> Module 4: Writing & Ingesting Data</h1>
          <p class="lead">Master efficient data ingestion techniques and optimize write performance in InfluxDB</p>
          <div class="mt-4">
            <span class="badge bg-light text-dark me-2"><i class="bi bi-clock"></i> 60 minutes</span>
            <span class="badge bg-light text-dark me-2"><i class="bi bi-bar-chart-fill"></i> Intermediate</span>
            <span class="badge bg-light text-dark"><i class="bi bi-lightning-fill"></i> Performance Focus</span>
          </div>
        </div>
        <div class="col-lg-4 text-center">
          <i class="bi bi-database-fill-down" style="font-size: 150px; opacity: 0.8;"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="module-nav">
    <div class="container">
      <ul class="nav nav-pills">
        <li class="nav-item">
          <a class="nav-link" href="#ingestion-methods">Ingestion Methods</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#line-protocol">Line Protocol</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#batch-writes">Batch Writes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#telegraf">Telegraf</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#best-practices">Best Practices</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container mt-5">

    <!-- Section 1: Ingestion Methods -->
    <section id="ingestion-methods">
      <h2 class="section-title"><i class="bi bi-diagram-3-fill"></i> Methods of Data Ingestion</h2>

      <div class="alert alert-info">
        <h5><i class="bi bi-info-circle-fill"></i> Multiple Ingestion Paths</h5>
        <p class="mb-0">InfluxDB supports multiple methods for writing data, each optimized for different use cases.
          Choose the method that best fits your architecture and requirements.</p>
      </div>

      <!-- Data Flow Diagram -->
      <div class="card">
        <div class="card-header" style="background: var(--primary-color); color: white;">
          <i class="bi bi-diagram-2"></i> Data Ingestion Flow
        </div>
        <div class="card-body">
          <div class="flow-diagram">
            <div class="flow-step">
              <i class="bi bi-file-code" style="font-size: 2.5rem; color: var(--primary-color);"></i>
              <h6 class="mt-2">Data Source</h6>
              <small class="text-muted">Applications, Sensors, Systems</small>
            </div>
            <div class="flow-arrow">→</div>
            <div class="flow-step">
              <i class="bi bi-arrow-down-circle" style="font-size: 2.5rem; color: var(--secondary-color);"></i>
              <h6 class="mt-2">Ingestion Method</h6>
              <small class="text-muted">HTTP API, Library, Telegraf</small>
            </div>
            <div class="flow-arrow">→</div>
            <div class="flow-step">
              <i class="bi bi-hdd-network" style="font-size: 2.5rem; color: var(--accent-color);"></i>
              <h6 class="mt-2">HTTP Endpoint</h6>
              <small class="text-muted">:8086/api/v2/write</small>
            </div>
            <div class="flow-arrow">→</div>
            <div class="flow-step">
              <i class="bi bi-database" style="font-size: 2.5rem; color: var(--success-color);"></i>
              <h6 class="mt-2">InfluxDB</h6>
              <small class="text-muted">Time-Series Storage</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Method Cards -->
      <h4 class="mt-5 mb-4">Choose Your Ingestion Method</h4>
      <div class="row">
        <div class="col-md-3">
          <div class="method-card" style="border-left-color: #FF6B6B;">
            <i class="bi bi-file-text method-icon" style="color: #FF6B6B;"></i>
            <h5>Line Protocol</h5>
            <p class="text-muted">Text-based format</p>
            <ul class="small">
              <li>Simple & readable</li>
              <li>Universal support</li>
              <li>Testing & debugging</li>
              <li>Shell scripts</li>
            </ul>
          </div>
        </div>

        <div class="col-md-3">
          <div class="method-card" style="border-left-color: #4ECDC4;">
            <i class="bi bi-cloud-arrow-up method-icon" style="color: #4ECDC4;"></i>
            <h5>HTTP API</h5>
            <p class="text-muted">RESTful interface</p>
            <ul class="small">
              <li>Language agnostic</li>
              <li>Batch writes</li>
              <li>Auth support</li>
              <li>Custom apps</li>
            </ul>
          </div>
        </div>

        <div class="col-md-3">
          <div class="method-card" style="border-left-color: #45B7D1;">
            <i class="bi bi-code-slash method-icon" style="color: #45B7D1;"></i>
            <h5>Client Libraries</h5>
            <p class="text-muted">Native integration</p>
            <ul class="small">
              <li>Python, JS, Go, Java</li>
              <li>Type safety</li>
              <li>Built-in batching</li>
              <li>Production apps</li>
            </ul>
          </div>
        </div>

        <div class="col-md-3">
          <div class="method-card" style="border-left-color: #10B981;">
            <i class="bi bi-robot method-icon" style="color: #10B981;"></i>
            <h5>Telegraf</h5>
            <p class="text-muted">Automated agent</p>
            <ul class="small">
              <li>300+ plugins</li>
              <li>Zero code</li>
              <li>High performance</li>
              <li>Monitoring</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Comparison Table -->
      <h4 class="mt-5 mb-4">Method Comparison</h4>
      <div class="comparison-table">
        <table class="table table-hover mb-0">
          <thead class="table-dark">
            <tr>
              <th>Method</th>
              <th>Use Case</th>
              <th>Performance</th>
              <th>Complexity</th>
              <th>Best For</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Line Protocol + curl</strong></td>
              <td>Testing, debugging</td>
              <td><span class="badge bg-warning">Medium</span></td>
              <td><span class="badge bg-success">Low</span></td>
              <td>Quick tests, scripts</td>
            </tr>
            <tr>
              <td><strong>HTTP API</strong></td>
              <td>Custom integrations</td>
              <td><span class="badge bg-success">High</span></td>
              <td><span class="badge bg-warning">Medium</span></td>
              <td>Language-agnostic apps</td>
            </tr>
            <tr>
              <td><strong>Client Libraries</strong></td>
              <td>Application integration</td>
              <td><span class="badge bg-success">High</span></td>
              <td><span class="badge bg-success">Low</span></td>
              <td>Production applications</td>
            </tr>
            <tr>
              <td><strong>Telegraf</strong></td>
              <td>Automated collection</td>
              <td><span class="badge bg-success">Very High</span></td>
              <td><span class="badge bg-success">Low</span></td>
              <td>System monitoring</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Interactive Method Selector -->
      <div class="interactive-tool mt-5">
        <h4><i class="bi bi-lightbulb-fill"></i> Interactive: Choose Your Ingestion Method</h4>
        <p>Answer a few questions to get a personalized recommendation</p>

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-bold">What are you building?</label>
              <select class="form-select" id="useCaseType">
                <option value="">Select...</option>
                <option value="monitoring">System/Application Monitoring</option>
                <option value="iot">IoT Data Collection</option>
                <option value="analytics">Real-time Analytics</option>
                <option value="logging">Log Aggregation</option>
                <option value="custom">Custom Application</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Expected Write Volume</label>
              <select class="form-select" id="writeVolume">
                <option value="">Select...</option>
                <option value="low">Low (< 1K points/sec)</option>
                <option value="medium">Medium (1K-10K points/sec)</option>
                <option value="high">High (10K-100K points/sec)</option>
                <option value="very-high">Very High (> 100K points/sec)</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Primary Language</label>
              <select class="form-select" id="primaryLang">
                <option value="">Select...</option>
                <option value="python">Python</option>
                <option value="javascript">JavaScript/Node.js</option>
                <option value="go">Go</option>
                <option value="java">Java</option>
                <option value="shell">Shell/Bash</option>
                <option value="other">Other</option>
              </select>
            </div>

            <button id="getRecommendationBtn" class="btn btn-demo">
              <i class="bi bi-magic"></i> Get Recommendation
            </button>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-bold">Recommendation:</label>
            <div class="output-console" id="methodRecommendation">
              Answer the questions to get a personalized recommendation...
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 2: Line Protocol -->
    <section id="line-protocol">
      <h2 class="section-title"><i class="bi bi-file-text-fill"></i> Line Protocol Format</h2>

      <div class="alert alert-info">
        <h5><i class="bi bi-info-circle-fill"></i> The Universal Format</h5>
        <p class="mb-0">Line Protocol is InfluxDB's text-based format. Understanding it is essential for all write
          methods.</p>
      </div>

      <!-- Line Protocol Structure -->
      <div class="card">
        <div class="card-header" style="background: var(--primary-color); color: white;">
          <i class="bi bi-diagram-2"></i> Line Protocol Structure
        </div>
        <div class="card-body">
          <div class="code-block">
            <div class="code-header">
              <span>Format</span>
            </div>
            <pre><code class="language-txt">&lt;measurement&gt;[,&lt;tag_key&gt;=&lt;tag_value&gt;] &lt;field_key&gt;=&lt;field_value&gt; [&lt;timestamp&gt;]</code></pre>
          </div>

          <div class="row mt-4">
            <div class="col-md-6">
              <h6><i class="bi bi-check-circle text-success"></i> Required Elements:</h6>
              <ul>
                <li><strong>Measurement:</strong> Name of the measurement</li>
                <li><strong>Field:</strong> At least one field key-value pair</li>
              </ul>
            </div>
            <div class="col-md-6">
              <h6><i class="bi bi-info-circle text-primary"></i> Optional Elements:</h6>
              <ul>
                <li><strong>Tags:</strong> Indexed metadata</li>
                <li><strong>Timestamp:</strong> Nanosecond precision</li>
              </ul>
            </div>
          </div>

          <div class="best-practice-card mt-4">
            <h6><i class="bi bi-star-fill text-warning"></i> Important Rules:</h6>
            <ul class="mb-0">
              <li>Whitespace separates measurement+tags from fields</li>
              <li>Whitespace separates fields from timestamp</li>
              <li>Commas separate tags and fields (no spaces)</li>
              <li>String field values must be double-quoted</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Examples -->
      <h4 class="mt-5 mb-4">Line Protocol Examples</h4>

      <div class="row">
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-success text-white">
              <i class="bi bi-thermometer-half"></i> Basic Temperature
            </div>
            <div class="card-body">
              <div class="code-block">
                <div class="code-header">
                  <span>Simple Example</span>
                  <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><code class="language-txt">temperature,location=room1 value=22.5</code></pre>
              </div>
              <small class="text-muted">
                <strong>Breakdown:</strong><br>
                • Measurement: <code>temperature</code><br>
                • Tag: <code>location=room1</code><br>
                • Field: <code>value=22.5</code><br>
                • Timestamp: Auto-generated
              </small>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-primary text-white">
              <i class="bi bi-cpu"></i> CPU Metrics
            </div>
            <div class="card-body">
              <div class="code-block">
                <div class="code-header">
                  <span>Multiple Fields</span>
                  <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><code class="language-txt">cpu,host=server01,cpu=cpu0 usage_idle=95.2,usage_system=2.1,usage_user=2.7</code></pre>
              </div>
              <small class="text-muted">
                <strong>Breakdown:</strong><br>
                • Measurement: <code>cpu</code><br>
                • Tags: <code>host</code>, <code>cpu</code><br>
                • Fields: 3 usage metrics
              </small>
            </div>
          </div>
        </div>
      </div>

      <!-- Timestamp Precision -->
      <h4 class="mt-5 mb-4">Timestamp Precision Options</h4>
      <div class="card">
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <div class="text-center p-3">
                <span class="precision-badge" style="background: #DBEAFE; color: #1E40AF;">ns</span>
                <h6 class="mt-2">Nanoseconds</h6>
                <code>1633024800000000000</code>
                <p class="small text-muted mt-2">High-frequency trading</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="text-center p-3">
                <span class="precision-badge" style="background: #FEF3C7; color: #92400E;">ms</span>
                <h6 class="mt-2">Milliseconds</h6>
                <code>1633024800000</code>
                <p class="small text-muted mt-2">Most common ⭐</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="text-center p-3">
                <span class="precision-badge" style="background: #ECFDF5; color: #065F46;">s</span>
                <h6 class="mt-2">Seconds</h6>
                <code>1633024800</code>
                <p class="small text-muted mt-2">Low-frequency sensors</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Interactive Line Protocol Builder -->
      <div class="interactive-tool mt-5">
        <h4><i class="bi bi-tools"></i> Interactive: Line Protocol Builder</h4>
        <p>Build and validate your line protocol statements</p>

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-bold">Measurement Name</label>
              <input type="text" class="form-control" id="lpMeasurement" placeholder="e.g., temperature"
                value="temperature">
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Tags (comma-separated)</label>
              <input type="text" class="form-control" id="lpTags" placeholder="e.g., location=room1,sensor=temp01"
                value="location=room1">
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Fields (comma-separated)</label>
              <input type="text" class="form-control" id="lpFields" placeholder="e.g., value=22.5,humidity=65"
                value="value=22.5">
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Include Timestamp?</label>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="lpIncludeTimestamp">
                <label class="form-check-label" for="lpIncludeTimestamp">
                  Add current timestamp
                </label>
              </div>
            </div>

            <button id="buildLineProtocolBtn" class="btn btn-demo">
              <i class="bi bi-hammer"></i> Build Line Protocol
            </button>
            <button id="validateLineProtocolBtn" class="btn btn-secondary">
              <i class="bi bi-check-circle"></i> Validate
            </button>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-bold">Generated Line Protocol:</label>
            <div class="output-console" id="lineProtocolOutput">
              Click "Build Line Protocol" to generate...
            </div>

            <button id="copyLPBtn" class="btn btn-secondary mt-3" style="display: none;">
              <i class="bi bi-clipboard"></i> Copy to Clipboard
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 3: Batch Writes -->
    <section id="batch-writes">
      <h2 class="section-title"><i class="bi bi-collection-fill"></i> Batch Writes & Performance</h2>

      <div class="alert alert-warning">
        <h5><i class="bi bi-lightning-fill"></i> Performance Critical</h5>
        <p class="mb-0">Batch writing is essential for high-performance ingestion. Writing individual points can cause
          severe performance issues.</p>
      </div>

      <!-- Performance Comparison -->
      <h4 class="mb-4">Single vs Batch Writes Performance</h4>
      <div class="performance-comparison">
        <div class="perf-box perf-bad">
          <i class="bi bi-x-circle" style="font-size: 3rem;"></i>
          <h5>Single Point Writes</h5>
          <div class="perf-value">~1K</div>
          <p>points/second</p>
          <hr style="border-color: rgba(255,255,255,0.3);">
          <div class="text-start small">
            <strong>Issues:</strong><br>
            • High network overhead<br>
            • Connection overhead<br>
            • Poor throughput<br>
            • Not production-ready
          </div>
        </div>

        <div class="perf-box perf-good">
          <i class="bi bi-check-circle" style="font-size: 3rem;"></i>
          <h5>Batch Writes (5000 pts)</h5>
          <div class="perf-value">~500K</div>
          <p>points/second</p>
          <hr style="border-color: rgba(255,255,255,0.3);">
          <div class="text-start small">
            <strong>Benefits:</strong><br>
            • 500x throughput increase<br>
            • Reduced network calls<br>
            • Optimal performance<br>
            • Production-ready ✅
          </div>
        </div>
      </div>

      <!-- Optimal Batch Sizes -->
      <h4 class="mt-5 mb-4">Optimal Batch Sizes</h4>
      <div class="stats-grid">
        <div class="stat-card">
          <i class="bi bi-check-circle" style="font-size: 2rem; color: var(--success-color);"></i>
          <div class="stat-value">5,000</div>
          <p class="mb-0">Recommended<br>Points per Batch</p>
        </div>
        <div class="stat-card">
          <i class="bi bi-clock" style="font-size: 2rem; color: var(--primary-color);"></i>
          <div class="stat-value">10s</div>
          <p class="mb-0">Recommended<br>Flush Interval</p>
        </div>
        <div class="stat-card">
          <i class="bi bi-file-earmark" style="font-size: 2rem; color: var(--accent-color);"></i>
          <div class="stat-value">5 MB</div>
          <p class="mb-0">Maximum<br>Batch Size</p>
        </div>
      </div>

      <!-- Code Examples -->
      <h4 class="mt-5 mb-4">Batch Write Examples</h4>

      <div class="card">
        <div class="card-header bg-primary text-white">
          <i class="bi bi-code-slash"></i> Python - Batch Write
        </div>
        <div class="card-body">
          <div class="code-block">
            <div class="code-header">
              <span>Using influxdb-client</span>
              <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>
            <pre><code class="language-python">from influxdb_client import InfluxDBClient, Point
from influxdb_client.client.write_api import SYNCHRONOUS

client = InfluxDBClient(url="http://localhost:8086", 
                        token="YOUR_TOKEN", org="myorg")
write_api = client.write_api(write_options=SYNCHRONOUS)

# Create batch of points
points = []
for i in range(5000):
    point = Point("temperature") \\
        .tag("location", f"room{i}") \\
        .field("value", 20 + i * 0.01)
    points.append(point)

# Write batch (single HTTP request)
write_api.write(bucket="mybucket", record=points)
print(f"Written {len(points)} points")

client.close()</code></pre>
          </div>
        </div>
      </div>

      <!-- Interactive Batch Simulator -->
      <div class="interactive-tool mt-5">
        <h4><i class="bi bi-speedometer2"></i> Interactive: Batch Write Simulator</h4>
        <p>Simulate batch writes and see the performance impact</p>

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-bold">Total Points to Write:</label>
              <input type="number" class="form-control" id="totalPoints" value="50000" min="1000" step="1000">
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Points per Batch:</label>
              <input type="range" class="form-range" id="batchSize" min="100" max="10000" step="100" value="5000">
              <div class="d-flex justify-content-between">
                <small>100</small>
                <strong id="batchSizeValue">5000</strong>
                <small>10000</small>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Write Method:</label>
              <select class="form-select" id="writeMethod">
                <option value="single">Single Point Writes (❌ Bad)</option>
                <option value="batch" selected>Batch Writes (✅ Good)</option>
              </select>
            </div>

            <button id="simulateWriteBtn" class="btn btn-demo">
              <i class="bi bi-play-circle"></i> Simulate Write
            </button>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-bold">Simulation Results:</label>
            <div class="output-console" id="simulationOutput">
              Configure parameters and click "Simulate Write"...
            </div>

            <div id="metricsDisplay" class="metrics-display" style="display: none;">
              <div class="metric-box">
                <div class="metric-label">Requests</div>
                <div class="metric-value" id="metricRequests">0</div>
              </div>
              <div class="metric-box">
                <div class="metric-label">Est. Time</div>
                <div class="metric-value" id="metricTime">0s</div>
              </div>
              <div class="metric-box">
                <div class="metric-label">Throughput</div>
                <div class="metric-value" id="metricThroughput">0</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Best Practices Card -->
      <div class="best-practice-card mt-5">
        <h5><i class="bi bi-bookmark-check-fill"></i> Batch Write Best Practices</h5>
        <div class="row">
          <div class="col-md-6">
            <h6 class="text-success"><i class="bi bi-check-circle"></i> DO:</h6>
            <ul>
              <li>Use 1,000-5,000 points per batch</li>
              <li>Flush every 10 seconds</li>
              <li>Keep batches under 5 MB</li>
              <li>Use async writes for high throughput</li>
            </ul>
          </div>
          <div class="col-md-6">
            <h6 class="text-danger"><i class="bi bi-x-circle"></i> DON'T:</h6>
            <ul>
              <li>Write one point at a time</li>
              <li>Use unbounded batch sizes</li>
              <li>Block on write acknowledgment</li>
              <li>Ignore write errors</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 4: Telegraf -->
    <section id="telegraf">
      <h2 class="section-title"><i class="bi bi-robot"></i> Using Telegraf for Automated Ingestion</h2>

      <div class="telegraf-visual">
        <div class="text-center mb-4">
          <i class="bi bi-robot" style="font-size: 5rem;"></i>
          <h3 class="mt-3">Telegraf: The Data Collection Agent</h3>
          <p class="lead">Plugin-driven server agent for collecting and sending metrics</p>
        </div>

        <div class="row">
          <div class="col-md-3 text-center">
            <i class="bi bi-puzzle" style="font-size: 3rem;"></i>
            <h5 class="mt-2">300+ Plugins</h5>
            <p>Input, output, processor, aggregator</p>
          </div>
          <div class="col-md-3 text-center">
            <i class="bi bi-lightning" style="font-size: 3rem;"></i>
            <h5 class="mt-2">High Performance</h5>
            <p>Written in Go, minimal overhead</p>
          </div>
          <div class="col-md-3 text-center">
            <i class="bi bi-gear" style="font-size: 3rem;"></i>
            <h5 class="mt-2">Easy Config</h5>
            <p>TOML format, hot reload</p>
          </div>
          <div class="col-md-3 text-center">
            <i class="bi bi-shield-check" style="font-size: 3rem;"></i>
            <h5 class="mt-2">Production Ready</h5>
            <p>Battle-tested, widely adopted</p>
          </div>
        </div>
      </div>

      <!-- Installation -->
      <h4 class="mt-5 mb-4">Quick Installation</h4>
      <div class="row">
        <div class="col-md-4">
          <div class="card h-100">
            <div class="card-header bg-primary text-white">
              <i class="bi bi-ubuntu"></i> Ubuntu/Debian
            </div>
            <div class="card-body">
              <div class="code-block">
                <pre><code class="language-bash">sudo apt-get update
sudo apt-get install telegraf</code></pre>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card h-100">
            <div class="card-header bg-success text-white">
              <i class="bi bi-apple"></i> macOS
            </div>
            <div class="card-body">
              <div class="code-block">
                <pre><code class="language-bash">brew install telegraf</code></pre>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card h-100">
            <div class="card-header bg-info text-white">
              <i class="bi bi-box"></i> Docker
            </div>
            <div class="card-body">
              <div class="code-block">
                <pre><code class="language-bash">docker pull telegraf:latest</code></pre>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Configuration Example -->
      <h4 class="mt-5 mb-4">Basic Configuration</h4>
      <div class="card">
        <div class="card-header" style="background: var(--secondary-color); color: white;">
          <i class="bi bi-file-earmark-code"></i> telegraf.conf
        </div>
        <div class="card-body">
          <div class="code-block">
            <div class="code-header">
              <span>Basic system monitoring setup</span>
              <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>
            <pre><code class="language-toml"># Global Agent Configuration
[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  flush_interval = "10s"

# Output Plugin - InfluxDB v2
[[outputs.influxdb_v2]]
  urls = ["http://localhost:8086"]
  token = "$INFLUX_TOKEN"
  organization = "myorg"
  bucket = "telegraf"

# Input Plugin - CPU
[[inputs.cpu]]
  percpu = true
  totalcpu = true

# Input Plugin - Memory
[[inputs.mem]]

# Input Plugin - Disk
[[inputs.disk]]
  ignore_fs = ["tmpfs", "devtmpfs"]

# Input Plugin - Network
[[inputs.net]]
  interfaces = ["eth0"]</code></pre>
          </div>
        </div>
      </div>

      <!-- Interactive Telegraf Config Generator -->
      <div class="interactive-tool mt-5">
        <h4><i class="bi bi-tools"></i> Interactive: Telegraf Config Generator</h4>
        <p>Generate a custom Telegraf configuration</p>

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-bold">Select Input Plugins:</label>
              <div class="form-check">
                <input class="form-check-input telegraf-plugin" type="checkbox" value="cpu" id="pluginCPU">
                <label class="form-check-label" for="pluginCPU">CPU Metrics</label>
              </div>
              <div class="form-check">
                <input class="form-check-input telegraf-plugin" type="checkbox" value="mem" id="pluginMem">
                <label class="form-check-label" for="pluginMem">Memory Metrics</label>
              </div>
              <div class="form-check">
                <input class="form-check-input telegraf-plugin" type="checkbox" value="disk" id="pluginDisk">
                <label class="form-check-label" for="pluginDisk">Disk Metrics</label>
              </div>
              <div class="form-check">
                <input class="form-check-input telegraf-plugin" type="checkbox" value="docker" id="pluginDocker">
                <label class="form-check-label" for="pluginDocker">Docker Stats</label>
              </div>
              <div class="form-check">
                <input class="form-check-input telegraf-plugin" type="checkbox" value="nginx" id="pluginNginx">
                <label class="form-check-label" for="pluginNginx">Nginx Stats</label>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Collection Interval (seconds):</label>
              <input type="number" class="form-control" id="collectionInterval" value="10" min="1">
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Organization:</label>
              <input type="text" class="form-control" id="influxOrg" value="myorg">
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Bucket:</label>
              <input type="text" class="form-control" id="influxBucket" value="telegraf">
            </div>

            <button id="generateConfigBtn" class="btn btn-demo">
              <i class="bi bi-gear"></i> Generate Config
            </button>
            <button id="downloadConfigBtn" class="btn btn-secondary" style="display: none;">
              <i class="bi bi-download"></i> Download Config
            </button>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-bold">Generated Configuration:</label>
            <div class="output-console" id="telegrafConfigOutput" style="white-space: pre-wrap;">
              Select plugins and click "Generate Config"...
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Start Timeline -->
      <h4 class="mt-5 mb-4">Quick Start Guide</h4>
      <div class="timeline">
        <div class="timeline-item">
          <h5>1. Install Telegraf</h5>
          <p>Use your platform's package manager or Docker</p>
        </div>

        <div class="timeline-item">
          <h5>2. Create Configuration</h5>
          <p>Use the generator above or create manually</p>
        </div>

        <div class="timeline-item">
          <h5>3. Set Environment Variables</h5>
          <div class="code-block">
            <pre><code class="language-bash">export INFLUX_TOKEN="your-token-here"</code></pre>
          </div>
        </div>

        <div class="timeline-item">
          <h5>4. Start Telegraf</h5>
          <div class="code-block">
            <pre><code class="language-bash">sudo systemctl start telegraf</code></pre>
          </div>
        </div>

        <div class="timeline-item">
          <h5>5. Verify Data</h5>
          <p>Check InfluxDB for incoming metrics</p>
        </div>
      </div>
    </section>

    <!-- Section 5: Best Practices -->
    <section id="best-practices">
      <h2 class="section-title"><i class="bi bi-star-fill"></i> Ingestion Best Practices</h2>

      <!-- High-Velocity Data -->
      <h4 class="mb-4">Handling High-Velocity Data Streams</h4>

      <div class="best-practice-card">
        <h5><i class="bi bi-check-circle-fill text-success"></i> DO: Optimize for High Throughput</h5>
        <ul>
          <li><strong>Use batch writes</strong> - 1000-5000 points per batch</li>
          <li><strong>Implement buffering</strong> - Buffer points in memory before writing</li>
          <li><strong>Parallel writes</strong> - Use multiple write threads/workers</li>
          <li><strong>Compress data</strong> - Use gzip compression for large batches</li>
          <li><strong>Async writes</strong> - Don't block on write acknowledgment</li>
          <li><strong>Connection pooling</strong> - Reuse connections efficiently</li>
        </ul>
      </div>

      <div class="danger-card">
        <h5><i class="bi bi-x-circle-fill text-danger"></i> DON'T: Common Mistakes</h5>
        <ul>
          <li><strong>Single point writes</strong> - Kills performance, never in production</li>
          <li><strong>Unbounded batches</strong> - Can cause memory issues and timeouts</li>
          <li><strong>Synchronous blocking</strong> - Reduces throughput significantly</li>
          <li><strong>No error handling</strong> - Lose data on failures</li>
          <li><strong>Ignore backpressure</strong> - Can overwhelm InfluxDB</li>
          <li><strong>Missing monitoring</strong> - Can't detect issues early</li>
        </ul>
      </div>

      <!-- Performance Benchmarks -->
      <h4 class="mt-5 mb-4">Expected Throughput</h4>
      <div class="comparison-table">
        <table class="table table-hover mb-0">
          <thead class="table-dark">
            <tr>
              <th>Scenario</th>
              <th>Throughput</th>
              <th>Configuration</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Single point writes</td>
              <td>~1K pts/sec</td>
              <td>One HTTP call per point</td>
              <td><span class="badge bg-danger">Not Recommended</span></td>
            </tr>
            <tr>
              <td>Small batches (100)</td>
              <td>~50K pts/sec</td>
              <td>Low latency focus</td>
              <td><span class="badge bg-warning">OK for low latency</span></td>
            </tr>
            <tr>
              <td>Medium batches (1000)</td>
              <td>~300K pts/sec</td>
              <td>Balanced approach</td>
              <td><span class="badge bg-info">Good</span></td>
            </tr>
            <tr>
              <td>Large batches (5000)</td>
              <td>~500K pts/sec</td>
              <td>Optimal configuration</td>
              <td><span class="badge bg-success">Recommended ⭐</span></td>
            </tr>
            <tr>
              <td>Optimal (10K, async)</td>
              <td>~1M pts/sec</td>
              <td>High throughput setup</td>
              <td><span class="badge bg-success">Very High</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Monitoring Metrics -->
      <h4 class="mt-5 mb-4">Monitor Your Ingestion Pipeline</h4>
      <div class="warning-card">
        <h5><i class="bi bi-graph-up"></i> Key Metrics to Track</h5>
        <div class="stats-grid">
          <div class="stat-card">
            <i class="bi bi-speedometer2" style="font-size: 2rem; color: var(--primary-color);"></i>
            <h6 class="mt-2">Write Throughput</h6>
            <p class="mb-0 text-muted small">Points per second</p>
          </div>
          <div class="stat-card">
            <i class="bi bi-clock-history" style="font-size: 2rem; color: var(--success-color);"></i>
            <h6 class="mt-2">Write Latency</h6>
            <p class="mb-0 text-muted small">P50, P95, P99</p>
          </div>
          <div class="stat-card">
            <i class="bi bi-x-circle" style="font-size: 2rem; color: var(--danger-color);"></i>
            <h6 class="mt-2">Error Rate</h6>
            <p class="mb-0 text-muted small">Failed writes %</p>
          </div>
          <div class="stat-card">
            <i class="bi bi-hourglass-split" style="font-size: 2rem; color: var(--warning-color);"></i>
            <h6 class="mt-2">Queue Depth</h6>
            <p class="mb-0 text-muted small">Buffered points</p>
          </div>
        </div>
      </div>

      <!-- Troubleshooting Guide -->
      <h4 class="mt-5 mb-4">Troubleshooting Common Issues</h4>
      <div class="accordion" id="troubleshootingAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#problem1">
              Problem: Slow Writes
            </button>
          </h2>
          <div id="problem1" class="accordion-collapse collapse show" data-bs-parent="#troubleshootingAccordion">
            <div class="accordion-body">
              <strong>Symptoms:</strong> High write latency, queue backing up, timeouts
              <hr>
              <strong>Solutions:</strong>
              <ul>
                <li>Increase batch size to 5000-10000</li>
                <li>Use async writes instead of synchronous</li>
                <li>Add more write workers/threads</li>
                <li>Check network latency between client and InfluxDB</li>
                <li>Verify InfluxDB server has sufficient resources</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#problem2">
              Problem: Data Loss
            </button>
          </h2>
          <div id="problem2" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
            <div class="accordion-body">
              <strong>Symptoms:</strong> Missing data points, gaps in time series
              <hr>
              <strong>Solutions:</strong>
              <ul>
                <li>Check error logs for write failures</li>
                <li>Verify authentication token is valid</li>
                <li>Monitor queue full events</li>
                <li>Implement overflow buffer for dropped points</li>
                <li>Add retry logic with exponential backoff</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#problem3">
              Problem: High Memory Usage
            </button>
          </h2>
          <div id="problem3" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
            <div class="accordion-body">
              <strong>Symptoms:</strong> OOM errors, process killed, system slowdown
              <hr>
              <strong>Solutions:</strong>
              <ul>
                <li>Reduce batch size to 2000-3000</li>
                <li>Lower queue size limits</li>
                <li>Flush more frequently (every 5 seconds)</li>
                <li>Check for memory leaks in application code</li>
                <li>Monitor and alert on queue depth</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Summary -->
    <section class="mt-5">
      <div class="card">
        <div class="card-header bg-dark text-white">
          <i class="bi bi-card-checklist"></i> Module Summary
        </div>
        <div class="card-body">
          <h5>What You've Learned:</h5>
          <div class="row">
            <div class="col-md-6">
              <ul>
                <li><i class="bi bi-check-circle text-success"></i> Multiple ingestion methods and when to use each</li>
                <li><i class="bi bi-check-circle text-success"></i> Line Protocol format and construction</li>
                <li><i class="bi bi-check-circle text-success"></i> Batch writing for 500x performance improvement</li>
              </ul>
            </div>
            <div class="col-md-6">
              <ul>
                <li><i class="bi bi-check-circle text-success"></i> Telegraf setup and configuration</li>
                <li><i class="bi bi-check-circle text-success"></i> High-velocity data stream handling</li>
                <li><i class="bi bi-check-circle text-success"></i> Production best practices and troubleshooting</li>
              </ul>
            </div>
          </div>

          <div class="alert alert-success mt-4">
            <h6><i class="bi bi-trophy-fill"></i> Key Takeaways</h6>
            <ol class="mb-0">
              <li><strong>Batch Everything:</strong> Never write single points in production</li>
              <li><strong>Use Telegraf:</strong> For automated monitoring with zero code</li>
              <li><strong>Monitor Pipeline:</strong> Track throughput, latency, and errors</li>
              <li><strong>Handle Errors:</strong> Implement retry logic and fallbacks</li>
              <li><strong>Optimize Configuration:</strong> 5000 points/batch, 10s flush</li>
            </ol>
          </div>

          <div class="mt-4 text-center">
            <a href="module-3-data-modeling.html" class="btn btn-outline-secondary me-2">
              <i class="bi bi-arrow-left-circle"></i> Back to Module 3
            </a>
            <button class="btn btn-demo btn-lg">
              <i class="bi bi-trophy"></i> Complete Module 4
            </button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <h5><i class="bi bi-database-fill"></i> InfluxDB Training Course</h5>
          <p>Master time-series data ingestion and write optimization</p>
        </div>
        <div class="col-md-6 text-end">
          <h6>Resources</h6>
          <ul class="list-unstyled">
            <li><a href="https://docs.influxdata.com/influxdb/latest/write-data/" target="_blank"
                class="text-white">Write Data Guide</a></li>
            <li><a href="https://docs.influxdata.com/telegraf/" target="_blank" class="text-white">Telegraf
                Documentation</a></li>
            <li><a href="https://github.com/influxdata" target="_blank" class="text-white">Client Libraries</a></li>
          </ul>
        </div>
      </div>
      <hr style="border-color: rgba(255,255,255,0.1);">
      <div class="text-center">
        <small>&copy; 2024 InfluxDB Training Course. All rights reserved.</small>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

  <script>
    // Copy code function
    function copyCode(button) {
      const codeBlock = button.closest('.code-block').querySelector('code');
      const text = codeBlock.textContent;

      navigator.clipboard.writeText(text).then(() => {
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.style.background = '#10B981';
        button.style.color = 'white';
        setTimeout(() => {
          button.textContent = originalText;
          button.style.background = 'transparent';
          button.style.color = '#888';
        }, 2000);
      });
    }

    // Method Recommendation
    document.getElementById('getRecommendationBtn').addEventListener('click', function () {
      const useCase = document.getElementById('useCaseType').value;
      const volume = document.getElementById('writeVolume').value;
      const lang = document.getElementById('primaryLang').value;

      if (!useCase || !volume || !lang) {
        document.getElementById('methodRecommendation').textContent = 'Please answer all questions to get a recommendation.';
        return;
      }

      let recommendation = '🎯 RECOMMENDATION\n\n';

      if (useCase === 'monitoring' || useCase === 'logging') {
        recommendation += '✅ PRIMARY METHOD: Telegraf\n\n';
        recommendation += 'Why Telegraf:\n';
        recommendation += '• Purpose-built for monitoring\n';
        recommendation += '• 300+ plugins available\n';
        recommendation += '• Minimal code required\n';
        recommendation += '• Production-ready\n';
        recommendation += '• Automatic batching\n\n';
        recommendation += '💡 ALTERNATIVE: Client library for custom metrics\n';
      } else if (volume === 'very-high') {
        recommendation += '✅ PRIMARY METHOD: Client Library with batching\n\n';
        recommendation += 'Why Client Library:\n';
        recommendation += '• Full control over batching\n';
        recommendation += '• Async write support\n';
        recommendation += '• Built-in retry logic\n';
        recommendation += '• Memory-efficient buffering\n\n';
        recommendation += `💡 Recommended: ${getLibraryForLang(lang)}\n\n`;
        recommendation += '⚙️  Critical settings:\n';
        recommendation += '• Batch size: 5000-10000 points\n';
        recommendation += '• Flush interval: 5-10 seconds\n';
        recommendation += '• Multiple write threads\n';
      } else if (lang === 'shell') {
        recommendation += '✅ PRIMARY METHOD: Line Protocol + curl\n\n';
        recommendation += 'Why curl:\n';
        recommendation += '• Simple shell scripting\n';
        recommendation += '• No dependencies\n';
        recommendation += '• Easy to debug\n';
        recommendation += '• Good for small volumes\n\n';
        recommendation += '💡 TIP: Use batch writes\n';
      } else {
        recommendation += `✅ PRIMARY METHOD: ${getLibraryForLang(lang)}\n\n`;
        recommendation += 'Why Client Library:\n';
        recommendation += '• Native language integration\n';
        recommendation += '• Type safety\n';
        recommendation += '• Built-in batching\n';
        recommendation += '• Production-tested\n\n';
        recommendation += '⚙️  Recommended config:\n';
        recommendation += `• Batch size: ${getBatchSize(volume)} points\n`;
        recommendation += `• Flush interval: ${getFlushInterval(volume)} seconds\n`;
      }

      recommendation += '\n📚 Next Steps:\n';
      recommendation += '1. Install the recommended tool\n';
      recommendation += '2. Configure batching parameters\n';
      recommendation += '3. Implement error handling\n';
      recommendation += '4. Test with production load\n';
      recommendation += '5. Monitor performance\n';

      document.getElementById('methodRecommendation').textContent = recommendation;
    });

    function getLibraryForLang(lang) {
      const libs = {
        'python': 'influxdb-client (pip install influxdb-client)',
        'javascript': '@influxdata/influxdb-client (npm install)',
        'go': 'influxdb-client-go',
        'java': 'influxdb-client-java',
        'other': 'HTTP API'
      };
      return libs[lang] || 'HTTP API';
    }

    function getBatchSize(volume) {
      const sizes = {
        'low': '1000-2000',
        'medium': '3000-5000',
        'high': '5000-7000',
        'very-high': '7000-10000'
      };
      return sizes[volume] || '5000';
    }

    function getFlushInterval(volume) {
      const intervals = {
        'low': '30',
        'medium': '10-15',
        'high': '5-10',
        'very-high': '3-5'
      };
      return intervals[volume] || '10';
    }

    // Line Protocol Builder
    let generatedLP = '';

    document.getElementById('buildLineProtocolBtn').addEventListener('click', function () {
      const measurement = document.getElementById('lpMeasurement').value.trim();
      const tags = document.getElementById('lpTags').value.trim();
      const fields = document.getElementById('lpFields').value.trim();
      const includeTimestamp = document.getElementById('lpIncludeTimestamp').checked;

      if (!measurement || !fields) {
        document.getElementById('lineProtocolOutput').textContent = '❌ ERROR: Measurement and Fields are required!';
        document.getElementById('lineProtocolOutput').style.color = '#EF4444';
        return;
      }

      let lineProtocol = measurement;
      if (tags) {
        lineProtocol += ',' + tags;
      }
      lineProtocol += ' ' + fields;

      if (includeTimestamp) {
        const timestamp = Date.now() * 1000000; // Convert to nanoseconds
        lineProtocol += ' ' + timestamp;
      }

      generatedLP = lineProtocol;

      let output = '✅ VALID LINE PROTOCOL\n\n';
      output += lineProtocol + '\n\n';
      output += '📊 Breakdown:\n';
      output += `• Measurement: ${measurement}\n`;
      if (tags) output += `• Tags: ${tags}\n`;
      output += `• Fields: ${fields}\n`;
      if (includeTimestamp) output += `• Timestamp: ${includeTimestamp ? 'Included' : 'Auto-generated'}\n`;

      document.getElementById('lineProtocolOutput').textContent = output;
      document.getElementById('lineProtocolOutput').style.color = '#10B981';
      document.getElementById('copyLPBtn').style.display = 'inline-block';
    });

    document.getElementById('validateLineProtocolBtn').addEventListener('click', function () {
      if (!generatedLP) {
        alert('Please build line protocol first!');
        return;
      }

      let output = '🔍 VALIDATION RESULT\n\n';
      output += '✅ Line protocol is valid!\n\n';
      output += '💡 Tips:\n';
      output += '• Tags should be low cardinality\n';
      output += '• Fields can be high cardinality\n';
      output += '• Timestamp is optional\n';
      output += '• Use commas without spaces\n';

      document.getElementById('lineProtocolOutput').textContent = output;
    });

    document.getElementById('copyLPBtn').addEventListener('click', function () {
      navigator.clipboard.writeText(generatedLP).then(() => {
        const btn = document.getElementById('copyLPBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="bi bi-check-circle"></i> Copied!';
        btn.classList.remove('btn-secondary');
        btn.classList.add('btn-success');
        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.classList.remove('btn-success');
          btn.classList.add('btn-secondary');
        }, 2000);
      });
    });

    // Batch Size Slider
    const batchSizeSlider = document.getElementById('batchSize');
    const batchSizeValue = document.getElementById('batchSizeValue');

    batchSizeSlider.addEventListener('input', function () {
      batchSizeValue.textContent = this.value;
    });

    // Batch Write Simulator
    document.getElementById('simulateWriteBtn').addEventListener('click', function () {
      const totalPoints = parseInt(document.getElementById('totalPoints').value);
      const batchSize = parseInt(document.getElementById('batchSize').value);
      const method = document.getElementById('writeMethod').value;

      let output = '📊 SIMULATION RESULTS\n\n';
      output += `Total Points: ${totalPoints.toLocaleString()}\n`;
      output += `Batch Size: ${batchSize.toLocaleString()}\n`;
      output += `Method: ${method === 'batch' ? 'Batch Writes' : 'Single Point Writes'}\n`;
      output += '─'.repeat(50) + '\n\n';

      let requests, time, throughput;

      if (method === 'single') {
        requests = totalPoints;
        time = (requests * 5) / 1000; // 5ms per request
        throughput = totalPoints / time;

        output += '❌ Single Point Writes (Inefficient)\n\n';
        output += `HTTP Requests: ${requests.toLocaleString()}\n`;
        output += `Est. Time: ${time.toFixed(2)} seconds\n`;
        output += `Throughput: ${Math.round(throughput).toLocaleString()} pts/sec\n`;
        output += `Network Overhead: HIGH ⚠️\n`;
        output += `Status: NOT PRODUCTION READY ❌\n\n`;
        output += `💡 Use batch writes for 500x improvement!\n`;
      } else {
        requests = Math.ceil(totalPoints / batchSize);
        time = (requests * 50) / 1000; // 50ms per batch
        throughput = totalPoints / time;

        output += '✅ Batch Writes (Optimized)\n\n';
        output += `Batches Needed: ${requests.toLocaleString()}\n`;
        output += `Est. Time: ${time.toFixed(2)} seconds\n`;
        output += `Throughput: ${Math.round(throughput).toLocaleString()} pts/sec\n`;
        output += `Network Overhead: LOW ✅\n`;
        output += `Status: PRODUCTION READY ✅\n\n`;

        if (batchSize < 1000) {
          output += `⚠️  Batch size could be larger (recommend 5000)\n`;
        } else if (batchSize > 10000) {
          output += `⚠️  Batch size might be too large (risk of timeout)\n`;
        } else {
          output += `✅ Optimal batch size!\n`;
        }
      }

      document.getElementById('simulationOutput').textContent = output;

      // Show metrics
      document.getElementById('metricRequests').textContent = requests.toLocaleString();
      document.getElementById('metricTime').textContent = time.toFixed(2) + 's';
      document.getElementById('metricThroughput').textContent = Math.round(throughput / 1000).toLocaleString() + 'K/s';
      document.getElementById('metricsDisplay').style.display = 'grid';
    });

    // Telegraf Config Generator
    let generatedConfig = '';

    document.getElementById('generateConfigBtn').addEventListener('click', function () {
      const interval = document.getElementById('collectionInterval').value;
      const org = document.getElementById('influxOrg').value;
      const bucket = document.getElementById('influxBucket').value;

      const selectedPlugins = [];
      document.querySelectorAll('.telegraf-plugin:checked').forEach(checkbox => {
        selectedPlugins.push(checkbox.value);
      });

      if (selectedPlugins.length === 0) {
        document.getElementById('telegrafConfigOutput').textContent = '⚠️  Please select at least one input plugin.';
        return;
      }

      let config = `# Telegraf Configuration\n# Generated: ${new Date().toISOString()}\n\n`;

      config += `[agent]\n`;
      config += `  interval = "${interval}s"\n`;
      config += `  metric_batch_size = 1000\n`;
      config += `  metric_buffer_limit = 10000\n`;
      config += `  flush_interval = "10s"\n\n`;

      config += `[[outputs.influxdb_v2]]\n`;
      config += `  urls = ["http://localhost:8086"]\n`;
      config += `  token = "$INFLUX_TOKEN"\n`;
      config += `  organization = "${org}"\n`;
      config += `  bucket = "${bucket}"\n\n`;

      selectedPlugins.forEach(plugin => {
        config += `# Input Plugin - ${plugin.toUpperCase()}\n`;
        config += `[[inputs.${plugin}]]\n`;

        if (plugin === 'cpu') {
          config += `  percpu = true\n`;
          config += `  totalcpu = true\n`;
        } else if (plugin === 'disk') {
          config += `  ignore_fs = ["tmpfs", "devtmpfs"]\n`;
        } else if (plugin === 'docker') {
          config += `  endpoint = "unix:///var/run/docker.sock"\n`;
        } else if (plugin === 'nginx') {
          config += `  urls = ["http://localhost/nginx_status"]\n`;
        }

        config += `\n`;
      });

      generatedConfig = config;
      document.getElementById('telegrafConfigOutput').textContent = config;
      document.getElementById('downloadConfigBtn').style.display = 'inline-block';
    });

    document.getElementById('downloadConfigBtn').addEventListener('click', function () {
      const blob = new Blob([generatedConfig], { type: 'text/plain' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'telegraf.conf';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
    });

    // Smooth scroll for navigation
    document.querySelectorAll('.module-nav a').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Highlight active nav item on scroll
    window.addEventListener('scroll', function () {
      const sections = document.querySelectorAll('section[id]');
      const navLinks = document.querySelectorAll('.module-nav .nav-link');

      let current = '';
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        if (pageYOffset >= sectionTop - 200) {
          current = section.getAttribute('id');
        }
      });

      navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === `#${current}`) {
          link.classList.add('active');
        }
      });
    });
  </script>
</body>

</html>