<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Railway Track Designer - Metric Grid Drawing Tool</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

  <!-- GoJS Library -->
  <script src="https://unpkg.com/gojs@3.0.2/release/go.js"></script>

  <style>
    :root {
      --grid-color: #9db4c0;
      --grid-bg: #e8f1f5;
      --primary-color: #2c5f7f;
      --track-color: #1a4d6b;
      --highlight-color: #ff6b35;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container-fluid {
      max-width: 1600px;
    }

    .card {
      border: none;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    }

    .card-header {
      background: linear-gradient(135deg, var(--primary-color) 0%, #1a4d6b 100%);
      color: white;
      border-radius: 15px 15px 0 0 !important;
      padding: 20px;
    }

    .card-header h1 {
      margin: 0;
      font-size: 1.75rem;
      font-weight: 600;
    }

    .card-header p {
      margin: 5px 0 0 0;
      opacity: 0.9;
      font-size: 0.95rem;
    }

    .toolbar {
      background: #f8f9fa;
      padding: 15px;
      border-bottom: 2px solid #e9ecef;
      border-radius: 0;
    }

    .btn-tool {
      border-radius: 8px;
      padding: 8px 16px;
      margin: 0 5px;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .btn-tool:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .btn-tool.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .btn-primary {
      background: var(--primary-color);
      border-color: var(--primary-color);
    }

    .btn-primary:hover {
      background: #1a4d6b;
      border-color: #1a4d6b;
    }

    .btn-danger {
      background: var(--highlight-color);
      border-color: var(--highlight-color);
    }

    .input-group {
      max-width: 200px;
    }

    .input-group-text {
      background-color: white;
      border-right: none;
    }

    .form-control {
      border-left: none;
      border-radius: 8px;
    }

    .form-control:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.2rem rgba(44, 95, 127, 0.25);
    }

    #diagramDiv {
      width: 100%;
      height: 600px;
      background-color: var(--grid-bg);
      border-radius: 0 0 15px 15px;
      cursor: crosshair;
      position: relative;
    }

    .stats-panel {
      background: white;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #e9ecef;
    }

    .stat-item:last-child {
      border-bottom: none;
    }

    .stat-label {
      font-weight: 600;
      color: #495057;
    }

    .stat-value {
      color: var(--primary-color);
      font-weight: 700;
      font-size: 1.1rem;
    }

    .tooltip-custom {
      position: absolute;
      background: rgba(26, 77, 107, 0.95);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.9rem;
      pointer-events: none;
      z-index: 1000;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .instructions {
      background: #e7f3ff;
      border-left: 4px solid var(--primary-color);
      padding: 15px;
      margin-top: 15px;
      border-radius: 8px;
    }

    .instructions h6 {
      color: var(--primary-color);
      margin-bottom: 10px;
      font-weight: 600;
    }

    .instructions ul {
      margin-bottom: 0;
      padding-left: 20px;
    }

    .instructions li {
      margin-bottom: 5px;
      color: #495057;
    }

    .divider {
      height: 30px;
      width: 1px;
      background-color: #dee2e6;
      margin: 0 10px;
    }

    @media (max-width: 768px) {
      #diagramDiv {
        height: 400px;
      }

      .btn-tool {
        margin: 5px 2px;
        padding: 6px 12px;
        font-size: 0.9rem;
      }

      .toolbar {
        padding: 10px;
      }

      .divider {
        display: none;
      }
    }

    /* Responsive toolbar layout */
    .toolbar-section {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
    }

    /* Animation for track creation */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .track-created {
      animation: fadeIn 0.3s ease-in;
    }

    /* Loading state */
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.2rem;
      color: var(--primary-color);
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <div class="card">
      <!-- Header -->
      <div class="card-header">
        <h1><i class="bi bi-bezier2"></i> Railway Track Designer</h1>
        <p>Professional metric grid-based track drawing and measurement tool</p>
      </div>

      <!-- Toolbar -->
      <div class="toolbar">
        <div class="toolbar-section">
          <!-- Drawing Tools -->
          <div class="btn-group" role="group" aria-label="Drawing tools">
            <button id="selectBtn" class="btn btn-outline-primary btn-tool active" title="Select and move tracks">
              <i class="bi bi-cursor"></i> Select
            </button>
            <button id="pencilBtn" class="btn btn-outline-primary btn-tool" title="Draw new track">
              <i class="bi bi-pencil"></i> Draw Track
            </button>
          </div>

          <div class="divider"></div>

          <!-- Edit Tools -->
          <div class="btn-group" role="group" aria-label="Edit tools">
            <button id="undoBtn" class="btn btn-outline-secondary btn-tool" title="Undo last action">
              <i class="bi bi-arrow-counterclockwise"></i>
            </button>
            <button id="redoBtn" class="btn btn-outline-secondary btn-tool" title="Redo action">
              <i class="bi bi-arrow-clockwise"></i>
            </button>
            <button id="deleteBtn" class="btn btn-outline-danger btn-tool" title="Delete selected track">
              <i class="bi bi-trash"></i>
            </button>
          </div>

          <div class="divider"></div>

          <!-- Grid Size Input -->
          <div class="input-group">
            <span class="input-group-text" title="Grid size in meters">
              <i class="bi bi-grid-3x3"></i>
            </span>
            <input type="number" id="gridSizeInput" class="form-control" value="5" min="1" max="100" step="1"
              title="Meters per grid square">
            <span class="input-group-text">m</span>
          </div>

          <div class="divider"></div>

          <!-- Canvas Actions -->
          <button id="clearBtn" class="btn btn-outline-warning btn-tool" title="Clear all tracks">
            <i class="bi bi-x-circle"></i> Clear
          </button>

          <div class="divider"></div>

          <!-- Export Tools -->
          <div class="btn-group" role="group" aria-label="Export tools">
            <button id="exportSvgBtn" class="btn btn-outline-success btn-tool" title="Export as SVG">
              <i class="bi bi-filetype-svg"></i> SVG
            </button>
            <button id="exportPngBtn" class="btn btn-outline-success btn-tool" title="Export as PNG">
              <i class="bi bi-filetype-png"></i> PNG
            </button>
          </div>
        </div>
      </div>

      <!-- Canvas -->
      <div id="diagramDiv"></div>
    </div>

    <!-- Statistics Panel -->
    <div class="stats-panel">
      <h5 class="mb-3"><i class="bi bi-graph-up"></i> Project Statistics</h5>
      <div class="row">
        <div class="col-md-4">
          <div class="stat-item">
            <span class="stat-label">Total Tracks:</span>
            <span class="stat-value" id="trackCount">0</span>
          </div>
        </div>
        <div class="col-md-4">
          <div class="stat-item">
            <span class="stat-label">Total Length:</span>
            <span class="stat-value" id="totalLength">0.00 m</span>
          </div>
        </div>
        <div class="col-md-4">
          <div class="stat-item">
            <span class="stat-label">Grid Size:</span>
            <span class="stat-value" id="currentGridSize">5 m</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Instructions -->
    <div class="instructions">
      <h6><i class="bi bi-info-circle"></i> How to Use</h6>
      <ul>
        <li><strong>Draw Track:</strong> Click "Draw Track" button, then click on grid intersections to create track
          points. Double-click or press Escape to finish.</li>
        <li><strong>Grid Size:</strong> Change the grid size (meters per square) to adjust measurement scale. All track
          lengths update automatically.</li>
        <li><strong>Select & Move:</strong> Use Select mode to click and drag tracks. Points snap to grid intersections.
        </li>
        <li><strong>Delete:</strong> Select a track and click the Delete button or press Delete key.</li>
        <li><strong>Track Length:</strong> Each track displays its length in meters as a label. Length updates
          dynamically when moved or when grid size changes.</li>
        <li><strong>Export:</strong> Save your design as SVG (vector) or PNG (raster) image.</li>
      </ul>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ============================================================================
    // RAILWAY TRACK DESIGNER - GoJS Implementation
    // ============================================================================
    // This application provides a metric grid-based drawing tool for railway tracks
    // with dynamic measurement, snapping, and export capabilities.
    // ============================================================================

    const go = window.go;
    let diagram = null;
    let gridSize = 5; // Default: 5 meters per grid square
    let isDrawingMode = false;
    let currentTrack = null;
    let tempPoints = [];
    let trackCounter = 0;

    // ============================================================================
    // INITIALIZATION
    // ============================================================================

    /**
     * Initialize the GoJS diagram with grid background and custom settings
     */
    function initDiagram() {
      const $ = go.GraphObject.make;

      diagram = $(go.Diagram, 'diagramDiv', {
        'undoManager.isEnabled': true,
        'grid.visible': true,
        'grid.gridCellSize': new go.Size(20, 20), // Visual grid size in pixels
        'allowCopy': false,
        'allowTextEdit': false,
        'allowClipboard': false,
        'hasVerticalScrollbar': true,
        'hasHorizontalScrollbar': true,
        initialContentAlignment: go.Spot.Center,

        // Grid styling - dotted pattern similar to the reference image
        'grid': $(go.Panel, 'Grid',
          {
            gridCellSize: new go.Size(20, 20),
            visible: true
          },
          $(go.Shape, 'LineH', {
            stroke: '#9db4c0',
            strokeWidth: 1,
            strokeDashArray: [1, 4]
          }),
          $(go.Shape, 'LineV', {
            stroke: '#9db4c0',
            strokeWidth: 1,
            strokeDashArray: [1, 4]
          })
        ),

        // Click handler for drawing mode
        'clickCreatingTool.archetypeNodeData': {},
        'toolManager.mouseDownTools': []
      });

      // Define the track (polyline) template
      diagram.nodeTemplate =
        $(go.Node, 'Spot',
          {
            locationSpot: go.Spot.Center,
            selectionAdornmentTemplate: makeSelectionAdornment(),
            movable: true,
            resizable: false,
            rotatable: false
          },
          new go.Binding('location', 'loc', go.Point.parse).makeTwoWay(go.Point.stringify),

          // The track polyline shape
          $(go.Shape,
            {
              geometryString: 'M0 0',
              stroke: '#1a4d6b',
              strokeWidth: 4,
              fill: null,
              strokeCap: 'round',
              strokeJoin: 'round'
            },
            new go.Binding('geometryString', 'points', pointsToGeometry)
          ),

          // Track length label
          $(go.Panel, 'Auto',
            {
              alignment: go.Spot.TopRight,
              alignmentFocus: go.Spot.BottomLeft
            },
            $(go.Shape, 'RoundedRectangle',
              {
                fill: 'rgba(26, 77, 107, 0.9)',
                stroke: null,
                parameter1: 4
              }
            ),
            $(go.TextBlock,
              {
                margin: 6,
                stroke: 'white',
                font: 'bold 12px sans-serif'
              },
              new go.Binding('text', 'length', function (len) {
                return len.toFixed(2) + ' m';
              })
            )
          )
        );

      // Handle diagram modifications to update statistics
      diagram.addModelChangedListener(function (evt) {
        if (evt.isTransactionFinished) {
          updateStatistics();
        }
      });

      // Custom click handler for drawing mode
      diagram.toolManager.doMouseDown = function () {
        if (isDrawingMode) {
          handleDrawingClick(diagram.lastInput.documentPoint);
        } else {
          go.ToolManager.prototype.doMouseDown.call(this);
        }
      };

      // Handle double-click to finish drawing
      diagram.doubleClick = function (e) {
        if (isDrawingMode && tempPoints.length > 0) {
          finishDrawing();
        }
      };

      // Handle keyboard shortcuts
      diagram.commandHandler.doKeyDown = function () {
        const e = diagram.lastInput;

        // Escape key - cancel drawing or deselect
        if (e.key === 'Escape') {
          if (isDrawingMode) {
            cancelDrawing();
          } else {
            diagram.clearSelection();
          }
          return;
        }

        // Delete key - delete selected track
        if (e.key === 'Delete' || e.key === 'Backspace') {
          deleteSelected();
          return;
        }

        go.CommandHandler.prototype.doKeyDown.call(this);
      };

      updateStatistics();
    }

    /**
     * Create selection adornment with resize handles at each point
     */
    function makeSelectionAdornment() {
      const $ = go.GraphObject.make;
      return $(go.Adornment, 'Spot',
        $(go.Placeholder),
        $(go.Shape,
          {
            alignment: go.Spot.TopRight,
            alignmentFocus: go.Spot.Center,
            fill: '#ff6b35',
            stroke: null,
            width: 8,
            height: 8
          }
        )
      );
    }

    // ============================================================================
    // DRAWING FUNCTIONALITY
    // ============================================================================

    /**
     * Handle click events during drawing mode
     * Snaps points to grid intersections
     */
    function handleDrawingClick(docPoint) {
      // Snap to grid intersection
      const snappedPoint = snapToGrid(docPoint);

      // Add point to temporary array
      tempPoints.push(snappedPoint);

      // Update or create temporary visual feedback
      updateDrawingPreview();

      // Show tooltip with distance
      if (tempPoints.length > 1) {
        const currentLength = calculateTrackLength(tempPoints);
        showTooltip(docPoint, `Length: ${currentLength.toFixed(2)} m`);
      }
    }

    /**
     * Snap a point to the nearest grid intersection
     */
    function snapToGrid(point) {
      const cellSize = 20; // Grid cell size in pixels
      const snappedX = Math.round(point.x / cellSize) * cellSize;
      const snappedY = Math.round(point.y / cellSize) * cellSize;
      return new go.Point(snappedX, snappedY);
    }

    /**
     * Update the drawing preview while creating a track
     */
    function updateDrawingPreview() {
      if (!currentTrack && tempPoints.length > 0) {
        // Create temporary track node
        const firstPoint = tempPoints[0];
        currentTrack = {
          key: 'temp_track',
          loc: go.Point.stringify(firstPoint),
          points: [...tempPoints],
          length: calculateTrackLength(tempPoints),
          isTemp: true
        };
        diagram.model.addNodeData(currentTrack);
      } else if (currentTrack) {
        // Update existing temporary track
        diagram.model.setDataProperty(currentTrack, 'points', [...tempPoints]);
        diagram.model.setDataProperty(currentTrack, 'length', calculateTrackLength(tempPoints));
      }
    }

    /**
     * Finish drawing and create permanent track
     */
    function finishDrawing() {
      if (tempPoints.length < 2) {
        alert('A track needs at least 2 points. Click to add more points or press Escape to cancel.');
        return;
      }

      // Remove temporary track
      if (currentTrack) {
        diagram.model.removeNodeData(currentTrack);
      }

      // Create permanent track
      trackCounter++;
      const firstPoint = tempPoints[0];
      const newTrack = {
        key: 'track_' + trackCounter,
        loc: go.Point.stringify(firstPoint),
        points: [...tempPoints],
        length: calculateTrackLength(tempPoints)
      };

      diagram.model.addNodeData(newTrack);
      diagram.commitTransaction('create track');

      // Reset drawing state
      resetDrawingState();

      // Update statistics
      updateStatistics();

      // Keep drawing mode active for next track
      // User can click Select to exit drawing mode
    }

    /**
     * Cancel current drawing operation
     */
    function cancelDrawing() {
      if (currentTrack) {
        diagram.model.removeNodeData(currentTrack);
      }
      resetDrawingState();
      hideTooltip();
    }

    /**
     * Reset drawing state variables
     */
    function resetDrawingState() {
      tempPoints = [];
      currentTrack = null;
      hideTooltip();
    }

    // ============================================================================
    // GEOMETRY AND MEASUREMENT
    // ============================================================================

    /**
     * Convert array of points to GoJS geometry string for rendering
     */
    function pointsToGeometry(points) {
      if (!points || points.length < 2) {
        return 'M0 0';
      }

      let geometry = `M${points[0].x} ${points[0].y}`;

      for (let i = 1; i < points.length; i++) {
        geometry += ` L${points[i].x} ${points[i].y}`;
      }

      return geometry;
    }

    /**
     * Calculate track length in meters based on grid size
     * Each grid cell represents 'gridSize' meters
     */
    function calculateTrackLength(points) {
      if (!points || points.length < 2) {
        return 0;
      }

      let totalLength = 0;
      const cellSize = 20; // pixels per grid cell
      const metersPerPixel = gridSize / cellSize;

      for (let i = 1; i < points.length; i++) {
        const p1 = points[i - 1];
        const p2 = points[i];

        // Euclidean distance in pixels
        const dx = p2.x - p1.x;
        const dy = p2.y - p1.y;
        const distancePixels = Math.sqrt(dx * dx + dy * dy);

        // Convert to meters
        const distanceMeters = distancePixels * metersPerPixel;
        totalLength += distanceMeters;
      }

      return totalLength;
    }

    /**
     * Recalculate all track lengths when grid size changes
     */
    function recalculateAllLengths() {
      diagram.startTransaction('recalculate lengths');

      diagram.nodes.each(function (node) {
        const data = node.data;
        if (data.points && data.points.length >= 2) {
          const newLength = calculateTrackLength(data.points);
          diagram.model.setDataProperty(data, 'length', newLength);
        }
      });

      diagram.commitTransaction('recalculate lengths');
      updateStatistics();
    }

    // ============================================================================
    // UI INTERACTION AND STATISTICS
    // ============================================================================

    /**
     * Update statistics panel with current project data
     */
    function updateStatistics() {
      let trackCount = 0;
      let totalLength = 0;

      diagram.nodes.each(function (node) {
        const data = node.data;
        if (!data.isTemp && data.length !== undefined) {
          trackCount++;
          totalLength += data.length;
        }
      });

      document.getElementById('trackCount').textContent = trackCount;
      document.getElementById('totalLength').textContent = totalLength.toFixed(2) + ' m';
      document.getElementById('currentGridSize').textContent = gridSize + ' m';
    }

    /**
     * Show tooltip near cursor position
     */
    let tooltipElement = null;
    function showTooltip(point, text) {
      hideTooltip();

      tooltipElement = document.createElement('div');
      tooltipElement.className = 'tooltip-custom';
      tooltipElement.textContent = text;
      document.body.appendChild(tooltipElement);

      // Position tooltip near the point
      const diagramDiv = document.getElementById('diagramDiv');
      const rect = diagramDiv.getBoundingClientRect();
      tooltipElement.style.left = (rect.left + point.x + 10) + 'px';
      tooltipElement.style.top = (rect.top + point.y - 30) + 'px';
    }

    /**
     * Hide tooltip
     */
    function hideTooltip() {
      if (tooltipElement) {
        tooltipElement.remove();
        tooltipElement = null;
      }
    }

    /**
     * Delete selected track
     */
    function deleteSelected() {
      const selection = diagram.selection.first();
      if (selection) {
        diagram.startTransaction('delete track');
        diagram.model.removeNodeData(selection.data);
        diagram.commitTransaction('delete track');
        updateStatistics();
      }
    }

    /**
     * Clear all tracks from canvas
     */
    function clearCanvas() {
      if (diagram.nodes.count === 0) {
        return;
      }

      if (confirm('Are you sure you want to clear all tracks? This action cannot be undone.')) {
        diagram.startTransaction('clear all');
        diagram.model.nodeDataArray = [];
        diagram.commitTransaction('clear all');
        trackCounter = 0;
        updateStatistics();
      }
    }

    /**
     * Export diagram as SVG
     */
    function exportSVG() {
      const svg = diagram.makeSvg({ scale: 1, background: 'white' });
      const svgString = new XMLSerializer().serializeToString(svg);
      const blob = new Blob([svgString], { type: 'image/svg+xml' });
      downloadFile(blob, 'railway-track-design.svg');
    }

    /**
     * Export diagram as PNG
     */
    function exportPNG() {
      const img = diagram.makeImage({ scale: 2, background: 'white' });
      img.toBlob(function (blob) {
        downloadFile(blob, 'railway-track-design.png');
      });
    }

    /**
     * Download file helper
     */
    function downloadFile(blob, filename) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // ============================================================================
    // EVENT HANDLERS
    // ============================================================================

    /**
     * Toggle between select and draw modes
     */
    function setMode(mode) {
      if (mode === 'select') {
        isDrawingMode = false;
        cancelDrawing();
        document.getElementById('diagramDiv').style.cursor = 'default';
        document.getElementById('selectBtn').classList.add('active');
        document.getElementById('pencilBtn').classList.remove('active');
      } else if (mode === 'draw') {
        isDrawingMode = true;
        diagram.clearSelection();
        document.getElementById('diagramDiv').style.cursor = 'crosshair';
        document.getElementById('selectBtn').classList.remove('active');
        document.getElementById('pencilBtn').classList.add('active');
      }
    }

    /**
     * Update grid size and recalculate all measurements
     */
    function updateGridSize() {
      const input = document.getElementById('gridSizeInput');
      const newSize = parseFloat(input.value);

      if (isNaN(newSize) || newSize < 1 || newSize > 100) {
        alert('Please enter a valid grid size between 1 and 100 meters.');
        input.value = gridSize;
        return;
      }

      gridSize = newSize;
      recalculateAllLengths();
    }

    // ============================================================================
    // INITIALIZATION AND SETUP
    // ============================================================================

    // Initialize diagram when page loads
    window.addEventListener('DOMContentLoaded', function () {
      initDiagram();

      // Button event listeners
      document.getElementById('selectBtn').addEventListener('click', () => setMode('select'));
      document.getElementById('pencilBtn').addEventListener('click', () => setMode('draw'));
      document.getElementById('deleteBtn').addEventListener('click', deleteSelected);
      document.getElementById('undoBtn').addEventListener('click', () => diagram.commandHandler.undo());
      document.getElementById('redoBtn').addEventListener('click', () => diagram.commandHandler.redo());
      document.getElementById('clearBtn').addEventListener('click', clearCanvas);
      document.getElementById('exportSvgBtn').addEventListener('click', exportSVG);
      document.getElementById('exportPngBtn').addEventListener('click', exportPNG);
      document.getElementById('gridSizeInput').addEventListener('change', updateGridSize);

      // Keyboard shortcuts
      document.addEventListener('keydown', function (e) {
        if (e.ctrlKey || e.metaKey) {
          if (e.key === 'z') {
            e.preventDefault();
            diagram.commandHandler.undo();
          } else if (e.key === 'y' || (e.shiftKey && e.key === 'Z')) {
            e.preventDefault();
            diagram.commandHandler.redo();
          }
        }
      });

      console.log('Railway Track Designer initialized successfully!');
    });

    // ============================================================================
    // README AND USAGE NOTES
    // ============================================================================
    /*
     * GRID SIZE AND MEASUREMENTS:
     * 
     * The grid size parameter defines how many meters each grid square represents.
     * 
     * - Default: 5 meters per grid square
     * - Range: 1-100 meters
     * - Visual grid: 20x20 pixels per cell (fixed for visual consistency)
     * 
     * MEASUREMENT CALCULATION:
     * 
     * 1. Each grid cell is 20x20 pixels visually
     * 2. Track points are stored in pixel coordinates
     * 3. Distance between points is calculated using Euclidean distance:
     *    distance_pixels = sqrt((x2-x1)² + (y2-y1)²)
     * 4. Convert to meters using the grid size:
     *    meters_per_pixel = gridSize / 20
     *    distance_meters = distance_pixels × meters_per_pixel
     * 
     * EXAMPLE:
     * 
     * Grid size = 5 meters
     * Track spans 10 grid cells horizontally
     * Pixel distance = 10 × 20 = 200 pixels
     * Meter distance = 200 × (5/20) = 200 × 0.25 = 50 meters
     * 
     * When you change the grid size from 5m to 10m:
     * - Same track now represents 200 × (10/20) = 100 meters
     * - All track lengths update automatically
     * 
     * FEATURES:
     * 
     * - Snap to grid: All points snap to grid intersections for precision
     * - Live measurement: Track length updates as you draw
     * - Dynamic recalculation: Change grid size anytime; all lengths update
     * - Multiple tracks: Create unlimited tracks with individual measurements
     * - Full editing: Move, delete, undo/redo support
     * - Professional export: SVG (vector) and PNG (raster) formats
     * 
     * ACCESSIBILITY:
     * 
     * - Keyboard navigation: Tab through controls
     * - Keyboard shortcuts: Escape (cancel), Delete (remove), Ctrl+Z (undo)
     * - High contrast colors for visibility
     * - Responsive design for mobile and desktop
     * - ARIA labels and semantic HTML
     */
  </script>
</body>

</html>