# 4Ô∏è‚É£ Writing Data (Hands-On)

---

## 4.1 Line Protocol - Complete Understanding

### **What is Line Protocol?**

```
Line Protocol = InfluxDB ka data format for writing data
Simple, text-based, human-readable
```

### **Complete Syntax:**

```
<measurement>[,<tag_key>=<tag_value>[,<tag_key>=<tag_value>]] <field_key>=<field_value>[,<field_key>=<field_value>] [<timestamp>]
```

**Breaking it down:**

```
measurement,tag1=value1,tag2=value2 field1=value1,field2=value2 timestamp
     ‚Üì           ‚Üì                           ‚Üì                      ‚Üì
  Required    Optional                   Required               Optional
  (name)      (metadata)                 (data)              (nanoseconds)
```

---

### **Component Details:**


| Component       | Required | Type             | Example                                |
| ----------------- | ---------- | ------------------ | ---------------------------------------- |
| **Measurement** | ‚úÖ Yes   | String           | `temperature_readings`                 |
| **Tags**        | ‚ùå No    | key=value pairs  | `sensor_id=SENS001,location=warehouse` |
| **Fields**      | ‚úÖ Yes   | key=value pairs  | `temperature=25.5,humidity=65.8`       |
| **Timestamp**   | ‚ùå No    | Unix nanoseconds | `1703000000000000000`                  |

---

### **Important Rules:**

```
‚úì Comma (,) between measurement and tags - NO SPACE
‚úì Space between tags and fields - REQUIRED
‚úì Space between fields and timestamp - REQUIRED
‚úì Comma (,) between multiple tags - NO SPACE
‚úì Comma (,) between multiple fields - NO SPACE
‚úì Tag order doesn't matter (internally sorted)
‚úì Field order doesn't matter
```

---

## 4.2 Line Protocol Examples (Simple ‚Üí Complex)

### **Example 1: Minimum Required (Measurement + Field)**

```
temperature temperature=25.5
```

**Breakdown:**

```
Measurement: temperature
Field: temperature=25.5
Tags: (none)
Timestamp: (auto-generated by InfluxDB = current time)
```

---

### **Example 2: With Tags**

```
temperature,location=warehouse,floor=2 temperature=25.5
```

**Breakdown:**

```
Measurement: temperature
Tags: location=warehouse, floor=2
Field: temperature=25.5
Timestamp: (auto-generated)
```

---

### **Example 3: Multiple Fields**

```
weather,location=bangalore temperature=28.5,humidity=65.8,pressure=1013.25
```

**Breakdown:**

```
Measurement: weather
Tags: location=bangalore
Fields: temperature=28.5, humidity=65.8, pressure=1013.25
Timestamp: (auto-generated)
```

---

### **Example 4: With Timestamp**

```
cpu_metrics,host=server01,region=us-east usage=78.5 1703000000000000000
```

**Breakdown:**

```
Measurement: cpu_metrics
Tags: host=server01, region=us-east
Field: usage=78.5
Timestamp: 1703000000000000000 (Dec 19, 2023, 00:00:00 UTC)
```

---

### **Example 5: Complex Real-World**

```
api_response,endpoint=/api/users,method=GET,status=200,region=ap-south response_time=145.6,bytes_sent=2048,success=true 1703000000000000000
```

**Breakdown:**

```
Measurement: api_response
Tags: 
  - endpoint=/api/users
  - method=GET
  - status=200
  - region=ap-south
Fields:
  - response_time=145.6
  - bytes_sent=2048
  - success=true
Timestamp: 1703000000000000000
```

---

## 4.3 Field Value Types

### **Integer Fields:**

```
cpu_metrics,host=server01 usage=78i,cores=8i
                              ‚Üë      ‚Üë
                              i = integer suffix
```

**Without 'i' suffix ‚Üí float by default!**

---

### **Float Fields:**

```
temperature,sensor=SENS001 value=25.5
                               ‚Üë
                          automatic float (no suffix needed)
```

---

### **String Fields (Quoted):**

```
logs,host=server01 message="Application started successfully",level="info"
                           ‚Üë                                         ‚Üë
                       must use double quotes
```

---

### **Boolean Fields:**

```
system_status,host=server01 is_active=true,is_healthy=false
                                   ‚Üë              ‚Üë
                              true/false or t/f or T/F
```

---

### **All Types Together:**

```
sensor_data,sensor_id=SENS001,location=lab temperature=25.5,reading_count=100i,status="online",is_calibrated=true
```

---

## 4.4 Common Line Protocol Mistakes

### **‚ùå Mistake 1: Space in Tags**

```
# WRONG
temperature, location=warehouse temperature=25.5
           ‚Üë
      space breaks it!

# RIGHT
temperature,location=warehouse temperature=25.5
```

---

### **‚ùå Mistake 2: No Space Between Tags and Fields**

```
# WRONG
temperature,location=warehousetemperature=25.5
                               ‚Üë
                          missing space!

# RIGHT
temperature,location=warehouse temperature=25.5
                              ‚Üë
                         space required!
```

---

### **‚ùå Mistake 3: Unquoted String Fields**

```
# WRONG
logs,host=server01 message=Application started
                          ‚Üë
                    string needs quotes!

# RIGHT
logs,host=server01 message="Application started"
```

---

### **‚ùå Mistake 4: Special Characters Without Escaping**

```
# WRONG
temperature,location=warehouse a temperature=25.5
                             ‚Üë
                    space in tag value!

# RIGHT (escaped)
temperature,location=warehouse\ a temperature=25.5
                             ‚Üë
                    backslash escapes space
```

---

### **‚ùå Mistake 5: Missing Field**

```
# WRONG (no fields = error!)
temperature,location=warehouse 1703000000000000000

# RIGHT
temperature,location=warehouse value=1 1703000000000000000
```

---

## 4.5 Writing Data - Method 1: CLI (influx write)

### **Basic Syntax:**

bash

```bash
influx write \
  --bucket BUCKET_NAME \
  --org ORG_NAME \
  --token YOUR_TOKEN \
  'LINE_PROTOCOL_HERE'
```

---

### **Example 1: Simple Write**

bash

```bash
influx write \
  --bucket my-bucket \
  --org my-org \
  --token YOUR_TOKEN \
  'temperature,location=bangalore temperature=28.5'
```

**Output:**

```
(no output = success!)
```

---

### **Example 2: Multiple Fields**

bash

```bash
influx write \
  --bucket my-bucket \
  --org my-org \
  'weather,location=bangalore temperature=28.5,humidity=65.8,pressure=1013.25'
```

---

### **Example 3: With Timestamp**

bash

```bash
# Get current timestamp in nanoseconds
TIMESTAMP=$(date +%s%N)

influx write \
  --bucket my-bucket \
  --org my-org \
  "cpu_metrics,host=server01 usage=78.5 $TIMESTAMP"
```

---

### **Example 4: Multiple Data Points**

bash

```bash
influx write \
  --bucket my-bucket \
  --org my-org \
  'temperature,sensor=SENS001 value=25.5
temperature,sensor=SENS002 value=26.2
temperature,sensor=SENS003 value=24.8'
```

**Note:** Each line = separate data point

---

### **Example 5: From File**

**Create file: `data.txt`**

```
temperature,location=bangalore,sensor=SENS001 temperature=25.5,humidity=65
temperature,location=mumbai,sensor=SENS002 temperature=32.1,humidity=78
temperature,location=delhi,sensor=SENS003 temperature=18.3,humidity=45
```

**Write from file:**

bash

```bash
influx write \
  --bucket my-bucket \
  --org my-org \
  --file data.txt
```

---

## 4.6 Writing Data - Method 2: HTTP API (curl)

### **Basic Syntax:**

bash

```bash
curl -X POST "http://localhost:8086/api/v2/write?org=ORG_NAME&bucket=BUCKET_NAME&precision=ns" \
  -H "Authorization: Token YOUR_TOKEN" \
  -H "Content-Type: text/plain; charset=utf-8" \
  --data-binary 'LINE_PROTOCOL_HERE'
```

---

### **Example 1: Simple HTTP Write**

bash

```bash
curl -X POST "http://localhost:8086/api/v2/write?org=my-org&bucket=my-bucket&precision=ns" \
  -H "Authorization: Token YOUR_TOKEN" \
  -H "Content-Type: text/plain; charset=utf-8" \
  --data-binary 'temperature,location=bangalore temperature=28.5'
```

**Success Response:**

```
HTTP/1.1 204 No Content
(empty body = success!)
```

---

### **Example 2: Multiple Points**

bash

```bash
curl -X POST "http://localhost:8086/api/v2/write?org=my-org&bucket=my-bucket" \
  -H "Authorization: Token YOUR_TOKEN" \
  -H "Content-Type: text/plain; charset=utf-8" \
  --data-binary 'cpu,host=server01 usage=78.5
cpu,host=server02 usage=65.2
cpu,host=server03 usage=82.1'
```

---

### **Example 3: Precision Parameter**

bash

```bash
# Millisecond precision
curl -X POST "http://localhost:8086/api/v2/write?org=my-org&bucket=my-bucket&precision=ms" \
  -H "Authorization: Token YOUR_TOKEN" \
  -H "Content-Type: text/plain; charset=utf-8" \
  --data-binary "temperature,sensor=SENS001 value=25.5 $(date +%s%3N)"
```

**Precision Options:**

```
ns = nanoseconds (default)
us = microseconds
ms = milliseconds
s  = seconds
```

---

### **Example 4: From File via HTTP**

bash

```bash
curl -X POST "http://localhost:8086/api/v2/write?org=my-org&bucket=my-bucket" \
  -H "Authorization: Token YOUR_TOKEN" \
  -H "Content-Type: text/plain; charset=utf-8" \
  --data-binary @data.txt
```

**Note:** `@` prefix reads from file

---

## 4.7 Real-World Example 1: IoT Sensor Data

### **Scenario: Temperature & Humidity Monitoring**

**Bash Script: `sensor_writer.sh`**

bash

```bash
#!/bin/bash

# Configuration
INFLUX_URL="http://localhost:8086"
INFLUX_ORG="my-org"
INFLUX_BUCKET="iot-sensors"
INFLUX_TOKEN="YOUR_TOKEN"

# Sensor data simulation
SENSOR_ID="SENS001"
LOCATION="warehouse_a"
FLOOR="2"

# Function to get current timestamp (nanoseconds)
get_timestamp() {
    echo $(date +%s%N)
}

# Function to simulate sensor reading
get_sensor_data() {
    # Random temperature between 20-30
    TEMP=$(awk -v min=20 -v max=30 'BEGIN{srand(); print min+rand()*(max-min)}')
  
    # Random humidity between 40-70
    HUMIDITY=$(awk -v min=40 -v max=70 'BEGIN{srand(); print min+rand()*(max-min)}')
  
    # Random battery level between 60-100
    BATTERY=$(shuf -i 60-100 -n 1)
  
    echo "$TEMP $HUMIDITY $BATTERY"
}

# Main loop
while true; do
    # Get sensor readings
    read TEMP HUMIDITY BATTERY <<< $(get_sensor_data)
    TIMESTAMP=$(get_timestamp)
  
    # Create line protocol
    LINE="temperature_readings,sensor_id=$SENSOR_ID,location=$LOCATION,floor=$FLOOR temperature=$TEMP,humidity=$HUMIDITY,battery_level=$BATTERY $TIMESTAMP"
  
    # Write to InfluxDB
    curl -X POST "$INFLUX_URL/api/v2/write?org=$INFLUX_ORG&bucket=$INFLUX_BUCKET&precision=ns" \
        -H "Authorization: Token $INFLUX_TOKEN" \
        -H "Content-Type: text/plain; charset=utf-8" \
        --data-binary "$LINE" \
        -s -o /dev/null
  
    echo "[$(date)] Written: Temp=$TEMP¬∞C, Humidity=$HUMIDITY%, Battery=$BATTERY%"
  
    # Wait 5 seconds
    sleep 5
done
```

**Run:**

bash

```bash
chmod +x sensor_writer.sh
./sensor_writer.sh
```

**Output:**

```
[2024-12-19 10:30:00] Written: Temp=25.3¬∞C, Humidity=62.1%, Battery=87%
[2024-12-19 10:30:05] Written: Temp=25.7¬∞C, Humidity=61.5%, Battery=86%
[2024-12-19 10:30:10] Written: Temp=25.4¬∞C, Humidity=62.8%, Battery=86%
```

---

## 4.8 Real-World Example 2: CPU/Memory Metrics

### **Python Script: `system_monitor.py`**

python

```python
#!/usr/bin/env python3

import psutil
import time
import requests
from datetime import datetime

# Configuration
INFLUX_URL = "http://localhost:8086/api/v2/write"
INFLUX_ORG = "my-org"
INFLUX_BUCKET = "system-metrics"
INFLUX_TOKEN = "YOUR_TOKEN"

# Headers
headers = {
    "Authorization": f"Token {INFLUX_TOKEN}",
    "Content-Type": "text/plain; charset=utf-8"
}

def get_timestamp_ns():
    """Get current timestamp in nanoseconds"""
    return int(time.time() * 1e9)

def collect_system_metrics():
    """Collect CPU and Memory metrics"""
  
    # CPU metrics
    cpu_percent = psutil.cpu_percent(interval=1)
    cpu_count = psutil.cpu_count()
  
    # Memory metrics
    memory = psutil.virtual_memory()
    memory_percent = memory.percent
    memory_used = memory.used
    memory_total = memory.total
  
    # Disk metrics
    disk = psutil.disk_usage('/')
    disk_percent = disk.percent
    disk_used = disk.used
  
    return {
        'cpu_percent': cpu_percent,
        'cpu_count': cpu_count,
        'memory_percent': memory_percent,
        'memory_used': memory_used,
        'memory_total': memory_total,
        'disk_percent': disk_percent,
        'disk_used': disk_used
    }

def write_to_influx(metrics):
    """Write metrics to InfluxDB"""
  
    timestamp = get_timestamp_ns()
    hostname = "server01"
    environment = "production"
  
    # Create line protocol
    lines = []
  
    # CPU metrics
    cpu_line = f"cpu_metrics,host={hostname},environment={environment} " \
               f"usage_percent={metrics['cpu_percent']},core_count={metrics['cpu_count']}i " \
               f"{timestamp}"
    lines.append(cpu_line)
  
    # Memory metrics
    memory_line = f"memory_metrics,host={hostname},environment={environment} " \
                  f"usage_percent={metrics['memory_percent']}," \
                  f"used_bytes={metrics['memory_used']}i," \
                  f"total_bytes={metrics['memory_total']}i " \
                  f"{timestamp}"
    lines.append(memory_line)
  
    # Disk metrics
    disk_line = f"disk_metrics,host={hostname},environment={environment} " \
                f"usage_percent={metrics['disk_percent']}," \
                f"used_bytes={metrics['disk_used']}i " \
                f"{timestamp}"
    lines.append(disk_line)
  
    # Join all lines
    data = "\n".join(lines)
  
    # Write to InfluxDB
    params = {
        'org': INFLUX_ORG,
        'bucket': INFLUX_BUCKET,
        'precision': 'ns'
    }
  
    try:
        response = requests.post(
            INFLUX_URL,
            params=params,
            headers=headers,
            data=data
        )
    
        if response.status_code == 204:
            print(f"[{datetime.now()}] ‚úì Metrics written successfully")
            print(f"  CPU: {metrics['cpu_percent']:.1f}%")
            print(f"  Memory: {metrics['memory_percent']:.1f}%")
            print(f"  Disk: {metrics['disk_percent']:.1f}%")
        else:
            print(f"[{datetime.now()}] ‚úó Error: {response.status_code}")
            print(response.text)
  
    except Exception as e:
        print(f"[{datetime.now()}] ‚úó Exception: {e}")

def main():
    """Main monitoring loop"""
    print("System Monitoring Started...")
    print("Press Ctrl+C to stop\n")
  
    try:
        while True:
            metrics = collect_system_metrics()
            write_to_influx(metrics)
            time.sleep(10)  # Collect every 10 seconds
  
    except KeyboardInterrupt:
        print("\nMonitoring stopped.")

if __name__ == "__main__":
    main()
```

**Install dependencies:**

bash

```bash
pip install psutil requests
```

**Run:**

bash

```bash
python3 system_monitor.py
```

**Output:**

```
System Monitoring Started...
Press Ctrl+C to stop

[2024-12-19 10:30:00] ‚úì Metrics written successfully
  CPU: 45.2%
  Memory: 68.5%
  Disk: 42.1%

[2024-12-19 10:30:10] ‚úì Metrics written successfully
  CPU: 47.8%
  Memory: 68.6%
  Disk: 42.1%
```

---

## 4.9 Real-World Example 3: Application Logs

### **Node.js Script: `app_logger.js`**

javascript

```javascript
const axios = require('axios');
const os = require('os');

// Configuration
const INFLUX_URL = 'http://localhost:8086/api/v2/write';
const INFLUX_ORG = 'my-org';
const INFLUX_BUCKET = 'application-logs';
const INFLUX_TOKEN = 'YOUR_TOKEN';

// Log levels
const LOG_LEVELS = {
    DEBUG: 'debug',
    INFO: 'info',
    WARN: 'warn',
    ERROR: 'error',
    FATAL: 'fatal'
};

class InfluxLogger {
    constructor() {
        this.hostname = os.hostname();
        this.appName = 'my-application';
        this.environment = 'production';
    }

    getTimestampNs() {
        return Date.now() * 1000000; // Convert ms to ns
    }

    escapeString(str) {
        // Escape special characters in string fields
        return str.replace(/\\/g, '\\\\')
                  .replace(/"/g, '\\"')
                  .replace(/\n/g, '\\n');
    }

    async writeLog(level, message, metadata = {}) {
        const timestamp = this.getTimestampNs();
        const escapedMessage = this.escapeString(message);

        // Build fields
        let fields = `message="${escapedMessage}",level="${level}"`;
    
        // Add metadata as fields
        if (metadata.response_time) {
            fields += `,response_time=${metadata.response_time}`;
        }
        if (metadata.user_id) {
            fields += `,user_id="${metadata.user_id}"`;
        }
        if (metadata.status_code) {
            fields += `,status_code=${metadata.status_code}i`;
        }

        // Build line protocol
        const line = `application_logs,host=${this.hostname},app=${this.appName},environment=${this.environment},severity=${level} ${fields} ${timestamp}`;

        try {
            const response = await axios.post(
                `${INFLUX_URL}?org=${INFLUX_ORG}&bucket=${INFLUX_BUCKET}&precision=ns`,
                line,
                {
                    headers: {
                        'Authorization': `Token ${INFLUX_TOKEN}`,
                        'Content-Type': 'text/plain; charset=utf-8'
                    }
                }
            );

            if (response.status === 204) {
                console.log(`[${new Date().toISOString()}] [${level.toUpperCase()}] ${message}`);
            }
        } catch (error) {
            console.error('Failed to write to InfluxDB:', error.message);
        }
    }

    debug(message, metadata) {
        return this.writeLog(LOG_LEVELS.DEBUG, message, metadata);
    }

    info(message, metadata) {
        return this.writeLog(LOG_LEVELS.INFO, message, metadata);
    }

    warn(message, metadata) {
        return this.writeLog(LOG_LEVELS.WARN, message, metadata);
    }

    error(message, metadata) {
        return this.writeLog(LOG_LEVELS.ERROR, message, metadata);
    }

    fatal(message, metadata) {
        return this.writeLog(LOG_LEVELS.FATAL, message, metadata);
    }
}

// Example usage
async function main() {
    const logger = new InfluxLogger();

    // Different log examples
    await logger.info('Application started successfully');
  
    await logger.debug('Database connection initialized', {
        response_time: 125.6
    });

    await logger.info('API request processed', {
        response_time: 245.3,
        user_id: 'user_12345',
        status_code: 200
    });

    await logger.warn('High memory usage detected', {
        response_time: 0
    });

    await logger.error('Failed to connect to external service', {
        response_time: 5000,
        status_code: 503
    });

    // Simulate application logs every 5 seconds
    setInterval(async () => {
        const randomResponseTime = Math.random() * 500 + 50;
        const randomStatusCode = Math.random() > 0.95 ? 500 : 200;
    
        await logger.info('API request completed', {
            response_time: randomResponseTime,
            user_id: `user_${Math.floor(Math.random() * 1000)}`,
            status_code: randomStatusCode
        });
    }, 5000);
}

main().catch(console.error);
```

**Install dependencies:**

bash

```bash
npm install axios
```

**Run:**

bash

```bash
node app_logger.js
```

**Output:**

```
[2024-12-19T10:30:00.000Z] [INFO] Application started successfully
[2024-12-19T10:30:01.000Z] [DEBUG] Database connection initialized
[2024-12-19T10:30:02.000Z] [INFO] API request processed
[2024-12-19T10:30:03.000Z] [WARN] High memory usage detected
[2024-12-19T10:30:04.000Z] [ERROR] Failed to connect to external service
[2024-12-19T10:30:09.000Z] [INFO] API request completed
```

---

## 4.10 Batch Writing Best Practices

### **Why Batch Writing?**

```
Single writes:
- 1 write = 1 HTTP request
- 1000 points = 1000 requests (slow!)
- High network overhead

Batch writes:
- 1000 points = 1 HTTP request
- 10-100x faster
- Lower network overhead
```

---

### **Optimal Batch Size:**

```
Recommended: 5,000 - 10,000 points per batch
Maximum: 25MB per request
Sweet spot: ~5MB batches
```

---

### **Batch Writing Example (Python):**

python

```python
import requests
import time

INFLUX_URL = "http://localhost:8086/api/v2/write"
INFLUX_ORG = "my-org"
INFLUX_BUCKET = "metrics"
INFLUX_TOKEN = "YOUR_TOKEN"

def write_batch(data_points):
    """Write batch of data points"""
  
    # Join all lines
    batch_data = "\n".join(data_points)
  
    headers = {
        "Authorization": f"Token {INFLUX_TOKEN}",
        "Content-Type": "text/plain; charset=utf-8"
    }
  
    params = {
        'org': INFLUX_ORG,
        'bucket': INFLUX_BUCKET,
        'precision': 'ns'
    }
  
    response = requests.post(
        INFLUX_URL,
        params=params,
        headers=headers,
        data=batch_data
    )
  
    return response.status_code == 204

# Collect data points in batch
batch = []
BATCH_SIZE = 5000

for i in range(10000):
    timestamp = int(time.time() * 1e9)
    line = f"temperature,sensor=SENS{i % 100:03d} value={(20 + i % 10) + (i % 100) / 100} {timestamp}"
    batch.append(line)
  
    # Write when batch is full
    if len(batch) >= BATCH_SIZE:
        if write_batch(batch):
            print(f"‚úì Written batch of {len(batch)} points")
        batch = []

# Write remaining points
if batch:
    if write_batch(batch):
        print(f"‚úì Written final batch of {len(batch)} points")
```

---

## 4.11 Error Handling

### **Common Errors & Solutions:**

**Error 1: 400 Bad Request (Invalid Line Protocol)**

```
Error: unable to parse 'temperature,location=bangalore': invalid field format
```

**Cause:** Missing field or syntax error

**Solution:**

bash

```bash
# Wrong
temperature,location=bangalore

# Right
temperature,location=bangalore value=25.5
```

---

**Error 2: 401 Unauthorized**

```
Error: unauthorized access
```

**Cause:** Invalid or missing token

**Solution:**

bash

```bash
# Check token
influx auth list

# Create new token if needed
influx auth create --all-access
```

---

**Error 3: 404 Not Found (Bucket doesn't exist)**

```
Error: bucket "my-bucket" not found
```

**Solution:**

bash

```bash
# Create bucket
influx bucket create --name my-bucket --retention 30d
```

---

**Error 4: 413 Payload Too Large**

```
Error: request entity too large
```

**Solution:** Reduce batch size (split into smaller batches)

---

### **Error Handling in Code:**

python

```python
def write_with_retry(data, max_retries=3):
    """Write with exponential backoff retry"""
  
    for attempt in range(max_retries):
        try:
            response = requests.post(
                INFLUX_URL,
                params={'org': INFLUX_ORG, 'bucket': INFLUX_BUCKET},
                headers={'Authorization': f'Token {INFLUX_TOKEN}'},
                data=data,
                timeout=10
            )
        
            if response.status_code == 204:
                return True
            elif response.status_code == 429:  # Rate limited
                wait_time = 2 ** attempt  # Exponential backoff
                print(f"Rate limited. Waiting {wait_time}s...")
                time.sleep(wait_time)
            else:
                print(f"Error {response.status_code}: {response.text}")
                return False
    
        except requests.exceptions.Timeout:
            print(f"Timeout on attempt {attempt + 1}")
            time.sleep(2 ** attempt)
    
        except Exception as e:
            print(f"Exception: {e}")
            return False
  
    return False
```

---

## 4.12 Performance Tips

### **1. Use Batch Writes**

```
‚úÖ Write 5000 points at once
‚ùå Write 5000 points one by one
```

### **2. Use Appropriate Precision**

```
‚úÖ Use 'ms' or 's' if nanosecond precision not needed
‚ùå Always using 'ns' (unnecessary overhead)
```

### **3. Reuse HTTP Connections**

python

```python
# Use session for connection pooling
session = requests.Session()
session.post(...)  # Reuses TCP connection
```

### **4. Compress Large Batches**

bash

```bash
curl -X POST "..." \
  -H "Content-Encoding: gzip" \
  --data-binary @data.txt.gz
```

### **5. Write Asynchronously**

python

```python
# Use async writes (don't block on response)
import asyncio
import aiohttp

async def write_async(data):
    async with aiohttp.ClientSession() as session:
        async with session.post(url, data=data) as response:
            return response.status
```

---

## üéØ Key Takeaways (Module 4)

```
‚úì Line Protocol = measurement,tags fields timestamp
‚úì Comma between measurement and tags (NO SPACE)
‚úì Space between tags and fields (REQUIRED)
‚úì String fields need double quotes
‚úì Integer fields need 'i' suffix
‚úì Batch writes = 10-100x faster
‚úì Optimal batch size = 5000-10000 points
‚úì Handle errors with retry logic
‚úì Use appropriate timestamp precision
```

---

## üìù Practice Tasks

**Task 1: Write Manual Data**

bash

```bash
# Write 5 temperature readings with different sensors
# Include: sensor_id, location, temperature, humidity
```

**Task 2: Create Bash Script**

bash

```bash
# Create script that writes CPU usage every 5 seconds
# Include: host, environment, cpu_percent
```

**Task 3: Batch Write Script**

python

```python
# Write Python script that:
# - Generates 10,000 data points
# - Writes in batches of 5000
# - Measures time taken
# - Handles errors
```

**Task 4: Error Handling**

```
# Intentionally create these errors and fix them:
# 1. Invalid line protocol
# 2. Missing field
# 3. Wrong bucket name
```
